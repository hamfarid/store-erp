# تصميم نظام البحث المتقدم عن الصور

## 1. الهدف

يهدف هذا المكون إلى تمكين المستخدمين من البحث عن صور زراعية ذات صلة عبر الإنترنت باستخدام كلمات مفتاحية محددة. سيتم استخدام هذه الصور كمرجع بصري أو لجمع بيانات إضافية للنظام.

## 2. النهج المقترح

نظرًا لقيود بيئة التشغيل وعدم توفر واجهات برمجة تطبيقات (APIs) مخصصة للبحث عن الصور بشكل مباشر، سيتم الاعتماد على الأدوات المتاحة لمحاكاة عملية البحث:

1.  **استخدام أداة البحث العامة (`info_search_web`)**: سيتم استخدام هذه الأداة للبحث عن صفحات ويب تحتوي على الصور المطلوبة باستخدام استعلامات بحث مصاغة بعناية (مثل "صور + [الكلمات المفتاحية]").
2.  **استخدام أدوات المتصفح (`browser_navigate`, `browser_scroll_down`, `browser_save_image`)**: 
    *   سيتم الانتقال إلى روابط صفحات نتائج البحث أو مواقع الصور التي تم العثور عليها.
    *   سيتم التمرير لأسفل في الصفحات لضمان تحميل وعرض أكبر عدد ممكن من الصور.
    *   سيتم استخدام أداة حفظ الصور لتنزيل الصور ذات الصلة بناءً على تحليل محتوى الصفحة أو سمات الصور (مثل النص البديل `alt`).
3.  **التصفية والمعالجة**: 
    *   سيتم تصفية الصور التي تم تنزيلها بناءً على معايير مثل الحجم (لتجنب الصور المصغرة أو الأيقونات) والصيغة.
    *   سيتم حفظ الصور التي تجتاز عملية التصفية في مجلد مخصص.
4.  **التحقق من المصدر**: سيتم استخدام المكون `SourceVerifier` لتقييم موثوقية الصفحة التي تم العثور على الصورة فيها.

## 3. المكونات والتنفيذ

-   **وحدة جديدة**: سيتم إنشاء وحدة بايثون جديدة باسم `src/data_collection/image_search.py`.
-   **فئة `ImageSearcher`**: ستحتوي هذه الفئة على الوظائف الرئيسية:
    *   `search(keywords: str, max_images: int = 10, min_reliability: float = 0.4) -> List[Dict]`: الوظيفة الرئيسية التي تأخذ الكلمات المفتاحية وتدير عملية البحث والتنزيل والتحقق.
    *   `_perform_web_search(keywords: str) -> List[str]`: تستخدم `info_search_web` للحصول على قائمة بالروابط المحتملة.
    *   `_scrape_images_from_url(url: str, keywords: List[str]) -> List[Dict]`: تستخدم أدوات المتصفح لزيارة الرابط، التمرير، وتحديد وتنزيل الصور ذات الصلة بالكلمات المفتاحية.
    *   `_filter_and_save_image(image_url: str, source_page_url: str, alt_text: str) -> Optional[Dict]`: تقوم بتنزيل الصورة، التحقق من حجمها وصيغتها، وحفظها إذا كانت مناسبة، مع إضافة معلومات المصدر.
-   **التكامل**: سيتم دمج هذه الوحدة في `main.py` لتوفير نقطة نهاية جديدة للبحث عن الصور.

## 4. تدفق البيانات

1.  المستخدم يقدم كلمات مفتاحية عبر الواجهة.
2.  `main.py` يستدعي `ImageSearcher.search()`.
3.  `ImageSearcher` تستدعي `_perform_web_search()` للحصول على روابط.
4.  لكل رابط، `ImageSearcher` تستدعي `SourceVerifier.verify_source()`.
5.  إذا كان المصدر موثوقًا، `ImageSearcher` تستدعي `_scrape_images_from_url()`.
6.  `_scrape_images_from_url()` تستخدم أدوات المتصفح للتنقل والتمرير وتحديد الصور.
7.  لكل صورة محتملة، تستدعي `_filter_and_save_image()`.
8.  `_filter_and_save_image()` تقوم بتنزيل الصورة، التحقق منها، وحفظها.
9.  `ImageSearcher.search()` تجمع النتائج (مسارات الصور المحفوظة، الروابط، معلومات المصدر) وتعيدها.
10. `main.py` يعرض النتائج للمستخدم.

## 5. التحديات المحتملة

-   **الاعتماد على بنية صفحات الويب**: عملية استخراج الصور من صفحات الويب باستخدام المتصفح قد تكون غير مستقرة وتعتمد على تصميم الصفحة.
-   **الكفاءة**: البحث والتصفح وتنزيل الصور بهذه الطريقة قد يكون بطيئًا مقارنة باستخدام واجهة برمجة تطبيقات مخصصة.
-   **قيود الاستخدام**: قد تفرض بعض المواقع قيودًا على الاستخراج الآلي للبيانات.
-   **دقة الصلة**: قد يكون من الصعب التأكد من أن الصور التي تم تنزيلها مرتبطة تمامًا بالكلمات المفتاحية بدون تحليل متقدم لمحتوى الصورة نفسها.

## 6. الخطوات التالية

-   تنفيذ الوحدة `src/data_collection/image_search.py` بناءً على هذا التصميم.
-   دمج الوحدة في `main.py`.
-   اختبار الوظيفة بشكل شامل.
