# تصميم نظام مواصفات الآباء والأمهات والبحث عن المقالات المتعلقة

## 1. الهدف

يهدف هذا المكون إلى تمكين المستخدمين من البحث عن مواصفات تفصيلية للأصناف النباتية المستخدمة كآباء أو أمهات في عمليات التهجين، بالإضافة إلى البحث عن مقالات علمية أو مصادر أخرى ذات صلة بهذه الأصناف عبر الإنترنت. سيتم التركيز على توفير معلومات دقيقة مع الإشارة إلى حالة حقوق النشر للمصادر الخارجية.

## 2. المكونات الرئيسية

### 2.1 قاعدة بيانات مواصفات الأصناف (Parent Specifications Database)

-   **التوسعة**: سيتم توسيع قاعدة البيانات الحالية (التي يديرها `DatabaseManager`) لتشمل جدولاً أو مجموعة جداول مخصصة لتخزين مواصفات الأصناف بشكل مفصل.
-   **الحقول المقترحة**: 
    *   `variety_id`: معرف فريد للصنف.
    *   `name`: اسم الصنف (الأسماء الشائعة والعلمية).
    *   `lineage`: معلومات النسب أو الأصل.
    *   `morphological_traits`: الخصائص الشكلية (الطول، شكل الورقة، لون الزهرة، إلخ).
    *   `physiological_traits`: الخصائص الفسيولوجية (معدل النمو، تحمل الجفاف/الملوحة، إلخ).
    *   `disease_resistance`: قائمة بالأمراض التي يقاومها الصنف ومستوى المقاومة.
    *   `yield_potential`: إمكانات الإنتاجية.
    *   `quality_traits`: خصائص الجودة (محتوى السكر، الحجم، اللون، إلخ).
    *   `growth_requirements`: متطلبات النمو (المناخ، التربة، الإضاءة).
    *   `references`: قائمة بالمراجع أو المصادر التي تم استقاء المعلومات منها (مع روابط إن أمكن).
    *   `is_parent_line`: علامة تشير إلى ما إذا كان الصنف يستخدم بشكل شائع كخط أبوي.
-   **إدارة البيانات**: سيتم تحديث `DatabaseManager` بوظائف لإضافة، تعديل، وحذف مواصفات الأصناف.

### 2.2 وحدة البحث عن المقالات والمعلومات (Article Search Module)

-   **الاعتماد**: ستعتمد هذه الوحدة بشكل كبير على `ComprehensiveInternetSearcher` الذي تم تطويره مسبقًا.
-   **الوظيفة**: ستقوم بأخذ اسم الصنف أو كلمات مفتاحية متعلقة به كمدخلات.
-   **صياغة الاستعلامات**: ستقوم بصياغة استعلامات بحث محددة (مثل "[اسم الصنف] مواصفات"، "[اسم الصنف] مقاومة الأمراض"، "مقالات علمية عن [اسم الصنف]").
-   **استخدام الفئات**: ستستخدم فئات مثل `specification`, `article`, `disease_resistance` عند استدعاء `ComprehensiveInternetSearcher` لتحسين دقة النتائج.
-   **معالجة النتائج**: ستقوم بتصفية وتنظيم النتائج التي تم إرجاعها من `ComprehensiveInternetSearcher`، مع التركيز على المصادر الموثوقة والمعلومات المتعلقة بالمواصفات أو الأبحاث.
-   **عرض حقوق النشر**: ستعرض بوضوح حالة حقوق النشر المقدرة لكل نتيجة بحث، مما يتيح للمستخدم اتخاذ قرار مستنير بشأن استخدام المعلومات.

### 2.3 التكامل مع وحدة التهجين (`PlantBreedingPredictor`)

-   **استرجاع المواصفات**: سيتم تعديل `PlantBreedingPredictor` لاسترجاع المواصفات التفصيلية للآباء والأمهات من قاعدة البيانات الجديدة قبل إجراء التنبؤ.
-   **إثراء المعلومات**: يمكن استخدام نتائج البحث عن المقالات لإثراء عملية التنبؤ أو توفير سياق إضافي للمستخدم.

## 3. التنفيذ المقترح

1.  **تعديل `DatabaseManager`**: إضافة وظائف CRUD (Create, Read, Update, Delete) لجدول مواصفات الأصناف.
2.  **إنشاء وحدة جديدة**: إنشاء `src/plant_breeding/specifications_manager.py`.
    *   فئة `SpecificationsManager`:
        *   `__init__(db_manager, comprehensive_searcher)`: تهيئة المدير.
        *   `get_specification(variety_name_or_id)`: استرجاع مواصفات صنف معين من قاعدة البيانات.
        *   `search_specifications(query_params)`: البحث في قاعدة البيانات عن أصناف تطابق معايير معينة.
        *   `find_related_articles(variety_name, max_results=5)`: استخدام `ComprehensiveInternetSearcher` للبحث عن مقالات ومعلومات عبر الإنترنت حول صنف معين.
        *   `add_specification(spec_data)`: إضافة مواصفات صنف جديد.
        *   `update_specification(variety_id, update_data)`: تحديث مواصفات صنف موجود.
3.  **تعديل `PlantBreedingPredictor`**: 
    *   استخدام `SpecificationsManager` لجلب بيانات الآباء.
    *   تضمين ملخص للمواصفات وربما روابط للمقالات ذات الصلة في نتائج التنبؤ.
4.  **تعديل `main.py`**: 
    *   تهيئة `SpecificationsManager`.
    *   إضافة أوامر أو نقاط نهاية جديدة للبحث عن مواصفات الأصناف والمقالات المتعلقة بها (مثل `search_variety_info`).
5.  **تعديل الواجهة (إذا كانت موجودة)**: إضافة أقسام لعرض مواصفات الأصناف ونتائج البحث عن المقالات.

## 4. تدفق العمليات (البحث عن معلومات صنف)

1.  المستخدم يقدم اسم الصنف عبر الواجهة أو سطر الأوامر.
2.  `main.py` يستدعي `SpecificationsManager.get_specification()` و `SpecificationsManager.find_related_articles()`.
3.  `get_specification()` يستعلم قاعدة البيانات المحلية ويعيد المواصفات المخزنة.
4.  `find_related_articles()` يصيغ استعلامات ويستدعي `ComprehensiveInternetSearcher.search()`.
5.  `ComprehensiveInternetSearcher` يبحث عبر الإنترنت، يحلل النتائج (بما في ذلك حقوق النشر)، ويعيد قائمة بالروابط والملخصات.
6.  `SpecificationsManager` يجمع النتائج من قاعدة البيانات والبحث عبر الإنترنت.
7.  `main.py` يعرض النتائج المجمعة للمستخدم، بما في ذلك المواصفات المحلية، والمقالات/المصادر عبر الإنترنت مع حالة حقوق النشر.

## 5. التعامل مع حقوق النشر

-   سيتم عرض حالة حقوق النشر المقدرة ("potentially_protected", "likely_clear_or_unspecified", "unknown") لكل مصدر عبر الإنترنت.
-   سيتم إضافة إخلاء مسؤولية واضح للمستخدم بأن هذه مجرد تقديرات وأن المستخدم هو المسؤول عن التحقق من شروط الاستخدام والامتثال لها قبل استخدام أي محتوى.
-   لن يقوم النظام بتنزيل أو تخزين محتوى المقالات المحمية بحقوق نشر بشكل مباشر، بل سيوفر روابط وملخصات فقط.

## 6. الخطوات التالية

-   تحديد مخطط قاعدة البيانات التفصيلي لمواصفات الأصناف.
-   تنفيذ التعديلات على `DatabaseManager`.
-   تنفيذ الوحدة `src/plant_breeding/specifications_manager.py`.
-   تعديل `PlantBreedingPredictor` و `main.py` للتكامل.
-   تحديث الاختبارات لتغطية الوظائف الجديدة.
