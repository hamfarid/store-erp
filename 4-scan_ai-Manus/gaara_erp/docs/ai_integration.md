# توثيق تكامل نظام Gaara ERP مع نظام الذكاء الاصطناعي الزراعي

## نظرة عامة

يوثق هذا المستند تكامل نظام Gaara ERP مع نظام الذكاء الاصطناعي الزراعي. يهدف هذا التكامل إلى توفير واجهة موحدة للمستخدمين للوصول إلى وظائف الذكاء الاصطناعي مباشرة من نظام ERP، وتمكين تبادل البيانات بسلاسة بين النظامين.

## المكونات الرئيسية

تم تنفيذ التكامل من خلال المكونات التالية:

### 1. وحدة التكامل الأساسية (AISystemIntegration)

توجد في المسار: `/src/core/integration/ai_system_integration.py`

تتضمن هذه الوحدة جميع الوظائف اللازمة للتواصل مع نظام الذكاء الاصطناعي ومزامنة البيانات بين النظامين، بما في ذلك:

- مزامنة طلبات ونتائج تشخيص الأمراض النباتية
- مزامنة طلبات ونتائج التهجين النباتي
- مزامنة البيانات المشتركة (المشاتل، المزارع، الأصناف، الأمراض)
- استيراد البيانات من نظام الذكاء الاصطناعي
- مراقبة حالة نظام الذكاء الاصطناعي

### 2. واجهة API للتكامل (FastAPI)

توجد في المسار: `/src/ai/controllers/ai_integration_controllers.py`

تتضمن هذه الوحدة نقاط نهاية API كاملة لجميع وظائف التكامل، بما في ذلك:

- إنشاء وإدارة طلبات تشخيص الأمراض النباتية
- إنشاء وإدارة طلبات التهجين النباتي
- إدارة خدمة المزامنة (بدء، إيقاف، مزامنة يدوية)
- مراقبة حالة نظام الذكاء الاصطناعي

### 3. اختبارات التكامل

توجد في المسار: `/tests/integration/test_ai_integration.py`

تتضمن هذه الوحدة اختبارات شاملة للتحقق من صحة التكامل وضمان عمل جميع المكونات معاً بشكل صحيح.

## آلية عمل التكامل

### مزامنة البيانات

يستخدم النظام آلية مزامنة تعمل في الخلفية لضمان تبادل البيانات بين نظام Gaara ERP ونظام الذكاء الاصطناعي الزراعي. تتضمن هذه الآلية:

1. **خدمة المزامنة**: تعمل في الخلفية وتقوم بمزامنة البيانات بشكل دوري.
2. **مزامنة يدوية**: يمكن للمستخدمين تشغيل المزامنة يدوياً عند الحاجة.
3. **مزامنة تلقائية**: تتم المزامنة تلقائياً عند إنشاء طلبات جديدة.

### تشخيص الأمراض النباتية

يتيح التكامل للمستخدمين إرسال صور النباتات لتشخيص الأمراض المحتملة. تتضمن العملية:

1. **إنشاء طلب تشخيص**: يقوم المستخدم برفع صورة النبات وتحديد نوع النبات ووصف الحالة.
2. **معالجة الطلب**: يتم إرسال الطلب إلى نظام الذكاء الاصطناعي للمعالجة.
3. **استلام النتيجة**: يتم استلام نتيجة التشخيص وتخزينها في قاعدة بيانات نظام ERP.
4. **عرض النتيجة**: يمكن للمستخدم عرض نتيجة التشخيص والتوصيات العلاجية.

### التهجين النباتي

يتيح التكامل للمستخدمين إنشاء طلبات تهجين لتحسين الأصناف النباتية. تتضمن العملية:

1. **إنشاء طلب تهجين**: يقوم المستخدم بتحديد أصناف الآباء وأهداف التهجين والقيود.
2. **معالجة الطلب**: يتم إرسال الطلب إلى نظام الذكاء الاصطناعي للمعالجة.
3. **استلام النتيجة**: يتم استلام نتيجة التهجين وتخزينها في قاعدة بيانات نظام ERP.
4. **عرض النتيجة**: يمكن للمستخدم عرض التقاطعات الموصى بها والصفات المتوقعة.

### مشاركة البيانات

يقوم النظام بمشاركة البيانات التالية بين نظام Gaara ERP ونظام الذكاء الاصطناعي الزراعي:

1. **بيانات المشاتل**: معلومات عن المشاتل والمخزون.
2. **بيانات المزارع**: معلومات عن المزارع والقطع.
3. **بيانات الأصناف**: معلومات عن الأصناف النباتية وخصائصها.
4. **بيانات الأمراض**: معلومات عن الأمراض النباتية وأعراضها وطرق علاجها.

## إعدادات التكامل

يتم تكوين التكامل من خلال ملف الإعدادات الذي يتضمن:

- **عنوان API**: عنوان واجهة API لنظام الذكاء الاصطناعي.
- **مفتاح API**: مفتاح API للمصادقة مع نظام الذكاء الاصطناعي.
- **مسارات المجلدات**: مسارات المجلدات المستخدمة لتخزين الصور والبيانات المشتركة.
- **فترة الاستطلاع**: الفترة الزمنية بين عمليات المزامنة الدورية.

## الصلاحيات

يتطلب استخدام وظائف التكامل الصلاحيات التالية:

- **ai.diagnosis.create**: إنشاء طلبات تشخيص.
- **ai.diagnosis.view**: عرض طلبات ونتائج التشخيص.
- **ai.breeding.create**: إنشاء طلبات تهجين.
- **ai.breeding.view**: عرض طلبات ونتائج التهجين.
- **ai.sync.manage**: إدارة خدمة المزامنة.
- **ai.system.view**: عرض حالة نظام الذكاء الاصطناعي.

## الاختبارات

تم تنفيذ اختبارات شاملة للتحقق من صحة التكامل، بما في ذلك:

- اختبارات وحدة التكامل الأساسية (AISystemIntegration).
- اختبارات واجهة API للتكامل.
- اختبارات المزامنة وتبادل البيانات.

## الاستخدام

### بدء خدمة المزامنة

```python
from core.config.config_manager import ConfigManager
from core.database.db_manager import DBManager
from core.integration.ai_system_integration import AISystemIntegration

# إنشاء مثيل AISystemIntegration
config_manager = ConfigManager()
db_manager = DBManager()
ai_integration = AISystemIntegration(config_manager, db_manager)

# بدء خدمة المزامنة
ai_integration.start_sync_service()
```

### إنشاء طلب تشخيص

```python
# استخدام واجهة API
import requests

# إعداد البيانات
files = {
    'image': ('plant.jpg', open('plant.jpg', 'rb'))
}
data = {
    'plant_type': 'tomato',
    'description': 'أوراق صفراء وبقع بنية'
}
headers = {
    'Authorization': 'Bearer YOUR_TOKEN'
}

# إرسال الطلب
response = requests.post(
    'http://localhost:8000/api/ai/diagnosis',
    files=files,
    data=data,
    headers=headers
)

# عرض النتيجة
print(response.json())
```

### إنشاء طلب تهجين

```python
# استخدام واجهة API
import requests
import json

# إعداد البيانات
data = {
    'parent_varieties': [
        {'variety_id': 'var1', 'name': 'Roma'},
        {'variety_id': 'var2', 'name': 'Cherry'}
    ],
    'breeding_goals': [
        {'trait': 'yield', 'target': 'increase', 'weight': 0.8},
        {'trait': 'disease_resistance', 'target': 'increase', 'weight': 0.6}
    ],
    'constraints': {
        'max_generations': 5,
        'population_size': 100
    },
    'parameters': {
        'selection_method': 'tournament',
        'crossover_rate': 0.8,
        'mutation_rate': 0.1
    }
}
headers = {
    'Authorization': 'Bearer YOUR_TOKEN',
    'Content-Type': 'application/json'
}

# إرسال الطلب
response = requests.post(
    'http://localhost:8000/api/ai/breeding',
    data=json.dumps(data),
    headers=headers
)

# عرض النتيجة
print(response.json())
```

## الخلاصة

يوفر التكامل بين نظام Gaara ERP ونظام الذكاء الاصطناعي الزراعي واجهة موحدة للمستخدمين للوصول إلى وظائف الذكاء الاصطناعي وتبادل البيانات بسلاسة بين النظامين. يتيح هذا التكامل للمستخدمين الاستفادة من قدرات الذكاء الاصطناعي في تشخيص الأمراض النباتية وتحسين الأصناف النباتية مباشرة من نظام ERP.
