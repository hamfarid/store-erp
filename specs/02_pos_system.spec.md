# ðŸ“‹ Spec: Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø§Ù„Ø¨ÙŠØ¹ | POS System

**Version:** 2.0.0
**Date:** 2026-01-16
**Role:** The Architect
**Status:** âœ… Approved
**Priority:** â­â­â­ Critical

---

## 1. Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© | Overview

Ù†Ø¸Ø§Ù… Ù†Ù‚Ø§Ø· Ø¨ÙŠØ¹ (POS) Ø§Ø­ØªØ±Ø§ÙÙŠ ÙˆØ³Ø±ÙŠØ¹ Ù…ØµÙ…Ù… Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ÙÙŠ Ø§Ù„Ù…Ø­Ù„Ø§Øª. ÙŠØ¯Ø¹Ù… Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ØŒ Ø§Ø®ØªÙŠØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙˆØªØ§Øª FIFOØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø¯ÙŠØ§ØªØŒ ÙˆØ·Ø±Ù‚ Ø¯ÙØ¹ Ù…ØªØ¹Ø¯Ø¯Ø©.

---

## 2. Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ© | Functional Requirements

### 2.1 Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª | Shift Management
- [ ] FR-001: ÙØªØ­ ÙˆØ±Ø¯ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø±ØµÙŠØ¯ Ø§ÙØªØªØ§Ø­ÙŠ
- [ ] FR-002: Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ù…Ø¹ ØªØ³ÙˆÙŠØ© Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚
- [ ] FR-003: ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙˆØ±Ø¯ÙŠØ© (Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§ØªØŒ Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§ØªØŒ Ø§Ù„Ø¯ÙØ¹Ø§Øª)
- [ ] FR-004: ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹
- [ ] FR-005: Ù†Ù‚Ù„ Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ù„ÙƒØ§Ø´ÙŠØ± Ø¢Ø®Ø±

### 2.2 Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ¹ | Sales Operations
- [ ] FR-006: Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©
- [ ] FR-007: Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
- [ ] FR-008: Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø§Ù„Ø¨Ø­Ø«
- [ ] FR-009: ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ù„Ø©
- [ ] FR-010: Ø­Ø°Ù Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©
- [ ] FR-011: ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬
- [ ] FR-012: ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… Ø¹Ù„Ù‰ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
- [ ] FR-013: Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©

### 2.3 Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ÙˆØªØ§Øª | Lot Selection
- [ ] FR-014: Ø§Ø®ØªÙŠØ§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ FIFO
- [ ] FR-015: Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØªØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
- [ ] FR-016: Ø§Ø®ØªÙŠØ§Ø± ÙŠØ¯ÙˆÙŠ Ù„Ù„ÙˆØª
- [ ] FR-017: ØªØ­Ø°ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ù„ÙˆØªØ§Øª Ù‚Ø±ÙŠØ¨Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
- [ ] FR-018: Ù…Ù†Ø¹ Ø¨ÙŠØ¹ Ø§Ù„Ù„ÙˆØªØ§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©

### 2.4 Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ | Payment Methods
- [ ] FR-019: Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯Ø§Ù‹ (Cash)
- [ ] FR-020: Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Card)
- [ ] FR-021: Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¢Ø¬Ù„ (Credit)
- [ ] FR-022: Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ (Transfer)
- [ ] FR-023: Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø®ØªÙ„Ø· (Split Payment)
- [ ] FR-024: Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ø§Ù‚ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

### 2.5 Ø§Ù„ÙÙˆØ§ØªÙŠØ± | Invoices
- [ ] FR-025: Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© Ø­Ø±Ø§Ø±ÙŠØ© (80mm)
- [ ] FR-026: Ø·Ø¨Ø§Ø¹Ø© ÙØ§ØªÙˆØ±Ø© A4
- [ ] FR-027: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯
- [ ] FR-028: Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨ÙˆØ§ØªØ³Ø§Ø¨
- [ ] FR-029: Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙƒÙ…Ø³ÙˆØ¯Ø©

### 2.6 Ø§Ù„Ù…Ø±ØªØ¬Ø¹Ø§Øª | Returns
- [ ] FR-030: Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒØ§Ù…Ù„ Ù„Ù„ÙØ§ØªÙˆØ±Ø©
- [ ] FR-031: Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¬Ø²Ø¦ÙŠ
- [ ] FR-032: Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…Ù†ØªØ¬
- [ ] FR-033: Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù„ÙˆØª Ù„Ù„Ù…Ø®Ø²ÙˆÙ†
- [ ] FR-034: Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ (Ø¥Ù„Ø²Ø§Ù…ÙŠ)

### 2.7 Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ | Customers
- [ ] FR-035: Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯
- [ ] FR-036: Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…ÙŠÙ„ Ø³Ø±ÙŠØ¹
- [ ] FR-037: Ø¹Ù…ÙŠÙ„ Ø¹Ø§Ø¨Ø± (Walk-in)
- [ ] FR-038: Ø¹Ø±Ø¶ Ø±ØµÙŠØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„
- [ ] FR-039: ØªØ·Ø¨ÙŠÙ‚ Ø­Ø¯ Ø§Ø¦ØªÙ…Ø§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„

---

## 3. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… | User Interface

### 3.1 Layout
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ðŸ” Ø¨Ø­Ø« Ø§Ù„Ù…Ù†ØªØ¬]  [ðŸ“· Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯]    [ðŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„] [âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                              â”‚  â”‚   Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª          â”‚â”‚
â”‚  â”‚      Ù…Ù†ØªØ¬Ø§Øª Ø³Ø±ÙŠØ¹Ø©           â”‚  â”‚                          â”‚â”‚
â”‚  â”‚      (Quick Products)       â”‚  â”‚   ðŸŒ¾ Ø¨Ø°ÙˆØ± Ø·Ù…Ø§Ø·Ù… (2 ÙƒØ¬Ù…)  â”‚â”‚
â”‚  â”‚                              â”‚  â”‚      Lot: L2024-001      â”‚â”‚
â”‚  â”‚  [Ù…Ù†ØªØ¬ 1] [Ù…Ù†ØªØ¬ 2] [Ù…Ù†ØªØ¬ 3] â”‚  â”‚      15.00 Ã— 2 = 30.00   â”‚â”‚
â”‚  â”‚  [Ù…Ù†ØªØ¬ 4] [Ù…Ù†ØªØ¬ 5] [Ù…Ù†ØªØ¬ 6] â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚
â”‚  â”‚  [Ù…Ù†ØªØ¬ 7] [Ù…Ù†ØªØ¬ 8] [Ù…Ù†ØªØ¬ 9] â”‚  â”‚   ðŸ§ª Ø³Ù…Ø§Ø¯ NPK (5 ÙƒØ¬Ù…)    â”‚â”‚
â”‚  â”‚                              â”‚  â”‚      Lot: L2024-015      â”‚â”‚
â”‚  â”‚                              â”‚  â”‚      45.00 Ã— 1 = 45.00   â”‚â”‚
â”‚  â”‚                              â”‚  â”‚                          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚
â”‚                                    â”‚   Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 75.00 Ø¬.Ù…     â”‚â”‚
â”‚                                    â”‚   Ø§Ù„Ø®ØµÙ…: 0.00            â”‚â”‚
â”‚                                    â”‚   Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: 11.25         â”‚â”‚
â”‚                                    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚â”‚
â”‚                                    â”‚   Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 86.25 Ø¬.Ù…    â”‚â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ðŸ’µ Ù†Ù‚Ø¯]  [ðŸ’³ Ø¨Ø·Ø§Ù‚Ø©]  [ðŸ“ Ø¢Ø¬Ù„]  [ðŸ”„ ØªØ­ÙˆÙŠÙ„]      [âœ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Quick Keys
| Key | Action |
|-----|--------|
| F1 | ÙØªØ­ Ø§Ù„Ø¨Ø­Ø« |
| F2 | Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ |
| F3 | Ø§Ø®ØªÙŠØ§Ø± Ø¹Ù…ÙŠÙ„ |
| F4 | ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… |
| F5 | Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¨ÙŠØ¹ |
| F8 | Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© |
| F10 | ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„ÙØ§ØªÙˆØ±Ø© |
| Esc | Ø§Ù„Ø¹ÙˆØ¯Ø© |

---

## 4. API Endpoints

### 4.1 Shift Management
```
POST   /api/v1/pos/shift/open          # Open new shift
POST   /api/v1/pos/shift/close         # Close current shift
GET    /api/v1/pos/shift/current       # Get current shift
GET    /api/v1/pos/shift/{id}/report   # Get shift report
POST   /api/v1/pos/shift/suspend       # Suspend shift
```

### 4.2 Sales Operations
```
POST   /api/v1/pos/sale                # Create sale
GET    /api/v1/pos/sale/{id}           # Get sale details
PUT    /api/v1/pos/sale/{id}           # Update sale (draft)
DELETE /api/v1/pos/sale/{id}           # Cancel sale
POST   /api/v1/pos/sale/{id}/complete  # Complete sale
POST   /api/v1/pos/sale/{id}/suspend   # Suspend sale
```

### 4.3 Product Search
```
GET    /api/v1/pos/products/search?q=  # Search products
GET    /api/v1/pos/products/barcode/{code}  # Get by barcode
GET    /api/v1/pos/products/quick      # Get quick products
```

### 4.4 Returns
```
POST   /api/v1/pos/sale/{id}/return    # Process return
GET    /api/v1/pos/returns             # List returns
GET    /api/v1/pos/return/{id}         # Get return details
```

### 4.5 Reports
```
GET    /api/v1/pos/daily-summary       # Daily summary
GET    /api/v1/pos/shift-report        # Shift report
GET    /api/v1/pos/sales-by-product    # Sales by product
GET    /api/v1/pos/sales-by-cashier    # Sales by cashier
```

---

## 5. Database Schema

### 5.1 POS Shifts Table
```sql
CREATE TABLE pos_shifts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    cashier_id INTEGER NOT NULL REFERENCES users(id),
    terminal_id VARCHAR(50) NOT NULL,
    
    -- Timing
    opened_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    closed_at TIMESTAMP,
    
    -- Cash
    opening_cash DECIMAL(15,2) NOT NULL DEFAULT 0,
    closing_cash DECIMAL(15,2),
    expected_cash DECIMAL(15,2),
    cash_difference DECIMAL(15,2),
    
    -- Totals
    total_sales DECIMAL(15,2) DEFAULT 0,
    total_returns DECIMAL(15,2) DEFAULT 0,
    total_cash_payments DECIMAL(15,2) DEFAULT 0,
    total_card_payments DECIMAL(15,2) DEFAULT 0,
    total_credit_payments DECIMAL(15,2) DEFAULT 0,
    
    -- Status
    status VARCHAR(20) NOT NULL DEFAULT 'open'
        CHECK (status IN ('open', 'suspended', 'closed')),
    notes TEXT,
    
    -- Audit
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 5.2 POS Sales Table
```sql
CREATE TABLE pos_sales (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sale_number VARCHAR(50) UNIQUE NOT NULL,
    shift_id INTEGER NOT NULL REFERENCES pos_shifts(id),
    customer_id INTEGER REFERENCES customers(id),
    
    -- Amounts
    subtotal DECIMAL(15,2) NOT NULL DEFAULT 0,
    discount_amount DECIMAL(15,2) DEFAULT 0,
    tax_amount DECIMAL(15,2) DEFAULT 0,
    total_amount DECIMAL(15,2) NOT NULL DEFAULT 0,
    
    -- Payment
    payment_method VARCHAR(20) NOT NULL
        CHECK (payment_method IN ('cash', 'card', 'credit', 'transfer', 'split')),
    amount_paid DECIMAL(15,2) DEFAULT 0,
    change_amount DECIMAL(15,2) DEFAULT 0,
    
    -- Status
    status VARCHAR(20) NOT NULL DEFAULT 'draft'
        CHECK (status IN ('draft', 'completed', 'cancelled', 'suspended', 'returned')),
    
    -- Audit
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    completed_at TIMESTAMP,
    created_by INTEGER REFERENCES users(id)
);
```

### 5.3 POS Sale Items Table
```sql
CREATE TABLE pos_sale_items (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sale_id INTEGER NOT NULL REFERENCES pos_sales(id),
    product_id INTEGER NOT NULL REFERENCES products(id),
    lot_id INTEGER REFERENCES lots(id),
    
    -- Quantities
    quantity DECIMAL(15,4) NOT NULL,
    unit_price DECIMAL(15,4) NOT NULL,
    discount_percent DECIMAL(5,2) DEFAULT 0,
    discount_amount DECIMAL(15,2) DEFAULT 0,
    tax_percent DECIMAL(5,2) DEFAULT 0,
    tax_amount DECIMAL(15,2) DEFAULT 0,
    total_amount DECIMAL(15,2) NOT NULL,
    
    -- Lot Info
    lot_number VARCHAR(50),
    lot_expiry_date DATE,
    
    -- Status
    is_returned BOOLEAN DEFAULT FALSE,
    returned_quantity DECIMAL(15,4) DEFAULT 0
);
```

---

## 6. Business Rules

### 6.1 Shift Rules
- Only one open shift per cashier
- Cannot process sales without open shift
- Must close shift at end of day
- Cash difference must be documented

### 6.2 Sale Rules
- At least one item required
- Quantity must be positive
- Cannot exceed available lot quantity
- Payment amount must equal or exceed total (except credit)

### 6.3 Return Rules
- Can only return completed sales
- Return within 30 days (configurable)
- Reason required
- Manager approval for large returns

### 6.4 FIFO Rules
```python
def auto_select_lot(product_id, quantity):
    """Auto-select lot using FIFO"""
    available_lots = Lot.query.filter(
        Lot.product_id == product_id,
        Lot.status == 'available',
        Lot.current_quantity > 0,
        Lot.expiry_date > datetime.now()
    ).order_by(
        Lot.expiry_date.asc(),
        Lot.received_date.asc()
    ).all()
    
    selected = []
    remaining = quantity
    
    for lot in available_lots:
        if remaining <= 0:
            break
        take = min(lot.current_quantity, remaining)
        selected.append({
            'lot_id': lot.id,
            'lot_number': lot.lot_number,
            'quantity': take,
            'expiry_date': lot.expiry_date
        })
        remaining -= take
    
    return selected, remaining
```

---

## 7. Testing Requirements

### 7.1 Unit Tests
- [ ] Test shift open/close
- [ ] Test sale creation
- [ ] Test FIFO lot selection
- [ ] Test payment calculations
- [ ] Test return processing

### 7.2 Integration Tests
- [ ] Test full sale workflow
- [ ] Test POS-Lot integration
- [ ] Test POS-Inventory sync
- [ ] Test receipt printing

### 7.3 E2E Tests
- [ ] Complete sale scenario
- [ ] Return scenario
- [ ] Shift reconciliation

---

## 8. Security Considerations

### 8.1 Permissions Required
| Operation | Permission |
|-----------|------------|
| Open shift | `pos.shift.open` |
| Close shift | `pos.shift.close` |
| Create sale | `pos.sale.create` |
| Process return | `pos.return.create` |
| Override FIFO | `pos.override_fifo` |
| Apply discount | `pos.discount.apply` |
| Cancel sale | `pos.sale.cancel` |
| View reports | `pos.reports.view` |

---

## 9. Related Files

- `backend/src/models/pos_*.py` - POS models
- `backend/src/routes/pos_routes.py` - API routes
- `backend/src/services/pos_service.py` - Business logic
- `frontend/src/pages/pos/` - POS interface
- `frontend/src/components/pos/` - POS components

---

*Spec Status: âœ… Approved*
*Implementation: âœ… Complete*
