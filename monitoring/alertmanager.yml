# -*- yaml -*-
# FILE: monitoring/alertmanager.yml | PURPOSE: Alertmanager Configuration for Notifications | OWNER: DevOps | RELATED: alert_rules.yml | LAST-AUDITED: 2025-10-21

# ØªÙƒÙˆÙŠÙ† Alertmanager Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø¹Ø±Ø¨ÙŠ
# Alertmanager Configuration for Notifications - Arabic Inventory Management System

global:
  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª SMTP Ù„Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
  # SMTP settings for email notifications
  smtp_smarthost: '${MAIL_SERVER}:${MAIL_PORT}'
  smtp_from: '${MAIL_USERNAME}'
  smtp_auth_username: '${MAIL_USERNAME}'
  smtp_auth_password: '${MAIL_PASSWORD}'
  smtp_require_tls: true

  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Slack
  # Slack settings
  slack_api_url: '${ALERT_SLACK_WEBHOOK}'

  # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©
  # General settings
  resolve_timeout: 5m
  http_config:
    tls_config:
      insecure_skip_verify: false

# Ù‚ÙˆØ§Ù„Ø¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
# Alert templates
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
# Route groups
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default-receiver'
  
  routes:
    # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø±Ø¬Ø© - ÙÙˆØ±ÙŠØ©
    # Critical alerts - immediate
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      group_interval: 5s
      repeat_interval: 5m
      continue: true

    # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù† - ÙÙˆØ±ÙŠØ©
    # Security alerts - immediate
    - match:
        category: security
      receiver: 'security-alerts'
      group_wait: 0s
      group_interval: 1s
      repeat_interval: 1m
      continue: true

    # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    # Database alerts
    - match:
        category: database
      receiver: 'database-alerts'
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 30m

    # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
    # Business alerts
    - match:
        category: business
      receiver: 'business-alerts'
      group_wait: 1m
      group_interval: 10m
      repeat_interval: 1h

    # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
    # Backup alerts
    - match:
        category: backup
      receiver: 'backup-alerts'
      group_wait: 5m
      group_interval: 1h
      repeat_interval: 6h

# ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Øª
# Receivers configuration
receivers:
  # Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
  # Default receiver
  - name: 'default-receiver'
    email_configs:
      - to: '${ALERT_EMAIL_RECIPIENTS}'
        subject: '[Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†] ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ø§Ù… - {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: {{ .Annotations.summary }}
          Ø§Ù„ÙˆØµÙ: {{ .Annotations.description }}
          Ø§Ù„Ø®Ø·ÙˆØ±Ø©: {{ .Labels.severity }}
          Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
        html: |
          <!DOCTYPE html>
          <html dir="rtl" lang="ar">
          <head>
            <meta charset="UTF-8">
            <title>ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>
          </head>
          <body style="font-family: Arial, sans-serif; direction: rtl;">
            <h2 style="color: #d9534f;">ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
            {{ range .Alerts }}
            <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0;">
              <h3>{{ .Annotations.summary }}</h3>
              <p><strong>Ø§Ù„ÙˆØµÙ:</strong> {{ .Annotations.description }}</p>
              <p><strong>Ø§Ù„Ø®Ø·ÙˆØ±Ø©:</strong> {{ .Labels.severity }}</p>
              <p><strong>Ø§Ù„ÙØ¦Ø©:</strong> {{ .Labels.category }}</p>
              <p><strong>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05" }}</p>
              {{ if .EndsAt }}
              <p><strong>ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</strong> {{ .EndsAt.Format "2006-01-02 15:04:05" }}</p>
              {{ end }}
            </div>
            {{ end }}
          </body>
          </html>

  # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø±Ø¬Ø©
  # Critical alerts
  - name: 'critical-alerts'
    email_configs:
      - to: '${ALERT_EMAIL_RECIPIENTS}'
        subject: 'ğŸš¨ [Ø­Ø±Ø¬] Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - {{ .GroupLabels.alertname }}'
        body: |
          âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø±Ø¬ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† âš ï¸
          
          {{ range .Alerts }}
          ğŸ”´ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: {{ .Annotations.summary }}
          ğŸ“ Ø§Ù„ÙˆØµÙ: {{ .Annotations.description }}
          â° Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          ğŸ·ï¸ Ø§Ù„ØªØµÙ†ÙŠÙ: {{ .Labels.category }}
          
          {{ end }}
          
          ÙŠØ±Ø¬Ù‰ Ø§ØªØ®Ø§Ø° Ø¥Ø¬Ø±Ø§Ø¡ ÙÙˆØ±ÙŠ Ù„Ø­Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©.
    
    slack_configs:
      - channel: '#critical-alerts'
        title: 'ğŸš¨ ØªÙ†Ø¨ÙŠÙ‡ Ø­Ø±Ø¬ - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†'
        text: |
          {{ range .Alerts }}
          *Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:* {{ .Annotations.summary }}
          *Ø§Ù„ÙˆØµÙ:* {{ .Annotations.description }}
          *Ø§Ù„Ø®Ø·ÙˆØ±Ø©:* {{ .Labels.severity }}
          *Ø§Ù„ÙˆÙ‚Øª:* {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
        send_resolved: true

  # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†
  # Security alerts
  - name: 'security-alerts'
    email_configs:
      - to: 'security@your-domain.com'
        subject: 'ğŸ” [Ø£Ù…Ø§Ù†] Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - {{ .GroupLabels.alertname }}'
        body: |
          ğŸ›¡ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ğŸ›¡ï¸
          
          {{ range .Alerts }}
          ğŸ”’ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: {{ .Annotations.summary }}
          ğŸ“‹ Ø§Ù„ÙˆØµÙ: {{ .Annotations.description }}
          â° Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          ğŸŒ Ø§Ù„Ù…ØµØ¯Ø±: {{ .Labels.instance }}
          
          {{ end }}
          
          ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø£Ù…Ø§Ù† ÙÙˆØ±Ø§Ù‹ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ù…Ø´Ø¨ÙˆÙ‡.

    slack_configs:
      - channel: '#security-alerts'
        title: 'ğŸ” ØªÙ†Ø¨ÙŠÙ‡ Ø£Ù…Ù†ÙŠ - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†'
        text: |
          {{ range .Alerts }}
          *Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:* {{ .Annotations.summary }}
          *Ø§Ù„ÙˆØµÙ:* {{ .Annotations.description }}
          *Ø§Ù„Ù…ØµØ¯Ø±:* {{ .Labels.instance }}
          *Ø§Ù„ÙˆÙ‚Øª:* {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          {{ end }}
        send_resolved: true

  # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  # Database alerts
  - name: 'database-alerts'
    email_configs:
      - to: 'dba@your-domain.com'
        subject: 'ğŸ’¾ [Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª] Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - {{ .GroupLabels.alertname }}'
        body: |
          ğŸ’¾ ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
          
          {{ range .Alerts }}
          ğŸ“Š Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: {{ .Annotations.summary }}
          ğŸ“ Ø§Ù„ÙˆØµÙ: {{ .Annotations.description }}
          â° Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          
          {{ end }}

  # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
  # Business alerts
  - name: 'business-alerts'
    email_configs:
      - to: 'business@your-domain.com'
        subject: 'ğŸ“ˆ [Ø£Ø¹Ù…Ø§Ù„] Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - {{ .GroupLabels.alertname }}'
        body: |
          ğŸ“ˆ ØªÙ†Ø¨ÙŠÙ‡ Ø£Ø¹Ù…Ø§Ù„ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
          
          {{ range .Alerts }}
          ğŸ’¼ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: {{ .Annotations.summary }}
          ğŸ“ Ø§Ù„ÙˆØµÙ: {{ .Annotations.description }}
          â° Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          
          {{ end }}

  # ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
  # Backup alerts
  - name: 'backup-alerts'
    email_configs:
      - to: 'backup@your-domain.com'
        subject: 'ğŸ’¾ [Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ] Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - {{ .GroupLabels.alertname }}'
        body: |
          ğŸ’¾ ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
          
          {{ range .Alerts }}
          ğŸ—„ï¸ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡: {{ .Annotations.summary }}
          ğŸ“ Ø§Ù„ÙˆØµÙ: {{ .Annotations.description }}
          â° Ø§Ù„ÙˆÙ‚Øª: {{ .StartsAt.Format "2006-01-02 15:04:05" }}
          
          {{ end }}

# Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„ØªØ«Ø¨ÙŠØ·
# Inhibit rules
inhibit_rules:
  # ØªØ«Ø¨ÙŠØ· ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªÙˆÙ‚Ù Ø§Ù„Ø®Ø¯Ù…Ø©
  # Inhibit system alerts when service is down
  - source_match:
      alertname: 'SystemDown'
    target_match:
      alertname: 'HighCPUUsage'
    equal: ['instance']

  - source_match:
      alertname: 'SystemDown'
    target_match:
      alertname: 'HighMemoryUsage'
    equal: ['instance']

  # ØªØ«Ø¨ÙŠØ· ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªÙˆÙ‚Ù Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  # Inhibit application alerts when database is down
  - source_match:
      alertname: 'DatabaseDown'
    target_match:
      alertname: 'HighErrorRate'

  - source_match:
      alertname: 'DatabaseDown'
    target_match:
      alertname: 'SlowResponseTime'
