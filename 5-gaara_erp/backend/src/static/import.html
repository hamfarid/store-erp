<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>استيراد البيانات - نظام إدارة المخزون</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; } .container { max-width: 1200px; margin: 0 auto; } .header { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; margin-bottom: 30px; text-align: center; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); } .header h1 { color: #2c3e50; font-size: 2.5rem; margin-bottom: 10px; } .header p { color: #7f8c8d; font-size: 1.1rem; } .back-btn { background: #27ae60; color: white; padding: 10px 20px; border: none; border-radius: 8px; text-decoration: none; display: inline-block; margin-bottom: 20px; transition: all 0.3s ease; } .back-btn:hover { background: #2ecc71; transform: translateY(-2px); } .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; } .card { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); } .card h2 { color: #2c3e50; margin-bottom: 20px; font-size: 1.5rem; } .upload-area { border: 2px dashed #3498db; border-radius: 10px; padding: 40px; text-align: center; transition: all 0.3s ease; cursor: pointer; margin-bottom: 20px; } .upload-area:hover { border-color: #2980b9; background: rgba(52, 152, 219, 0.1); } .upload-area.dragover { border-color: #27ae60; background: rgba(39, 174, 96, 0.1); } .upload-icon { font-size: 3rem; color: #3498db; margin-bottom: 15px; } .upload-text { color: #7f8c8d; font-size: 1.1rem; margin-bottom: 15px; } .file-input { display: none; } .btn { background: linear-gradient(135deg, #3498db, #2980b9); color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; text-decoration: none; display: inline-block; margin: 5px; } .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3); } .btn.success { background: linear-gradient(135deg, #2ecc71, #27ae60); } .btn.warning { background: linear-gradient(135deg, #f39c12, #e67e22); } .btn.danger { background: linear-gradient(135deg, #e74c3c, #c0392b); } .templates-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px; } .template-card { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; text-align: center; transition: all 0.3s ease; } .template-card:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); } .template-card h3 { color: #2c3e50; margin-bottom: 10px; } .template-card p { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 15px; } .progress-container { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); display: none; } .progress-bar { background: #ecf0f1; border-radius: 10px; height: 20px; overflow: hidden; margin: 20px 0; } .progress-fill { background: linear-gradient(135deg, #2ecc71, #27ae60); height: 100%; width: 0%; transition: width 0.3s ease; } .results-container { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); display: none; margin-top: 30px; } .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; } .stat-card { background: #f8f9fa; border-radius: 10px; padding: 20px; text-align: center; } .stat-number { font-size: 2rem; font-weight: bold; color: #2c3e50; } .stat-label { color: #7f8c8d; margin-top: 5px; } .alert { padding: 15px; border-radius: 8px; margin: 15px 0; } .alert.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; } .alert.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; } .alert.warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; } @media (max-width: 768px) { .main-content { grid-template-columns: 1fr; } .header h1 { font-size: 2rem; } } </style></head><body><div class="container"><!-- Header --><div class="header"><a href="/" class="back-btn"><i class="fas fa-arrow-right"></i> العودة للرئيسية </a><h1><i class="fas fa-file-import"></i> استيراد البيانات </h1><p>استيراد البيانات من ملفات Excel إلى النظام</p></div><!-- Main Content --><div class="main-content"><!-- Upload Section --><div class="card"><h2><i class="fas fa-upload"></i> رفع ملف Excel </h2><div class="upload-area" onclick="document.getElementById('fileInput').click()"><div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div><div class="upload-text"> اضغط هنا لاختيار ملف Excel أو اسحب الملف إلى هنا </div><div style="font-size: 0.9rem; color: #95a5a6;"> الصيغ المدعومة: .xlsx, .xls </div></div><input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls" onchange="handleFileSelect(event)"><div id="fileInfo" style="display: none; margin-top: 15px;"><div style="background: #f8f9fa; padding: 15px; border-radius: 8px;"><h4 style="color: #2c3e50; margin-bottom: 10px;">معلومات الملف:</h4><div id="fileDetails"></div><button type="button" class="btn success" onclick="uploadFile()" style="margin-top: 15px;"><i class="fas fa-upload"></i> رفع الملف </button></div></div></div><!-- Templates Section --><div class="card"><h2><i class="fas fa-file-download"></i> قوالب الاستيراد </h2><p style="color: #7f8c8d; margin-bottom: 20px;"> حمل القوالب الجاهزة لتنسيق بياناتك قبل الاستيراد </p><div class="templates-grid"><div class="template-card"><h3>قالب المنتجات</h3><p>لاستيراد المنتجات والأصناف</p><button type="button" class="btn" onclick="downloadTemplate('products')"><i class="fas fa-download"></i> تحميل </button></div><div class="template-card"><h3>قالب المخزون</h3><p>لاستيراد بيانات المخزون</p><button type="button" class="btn" onclick="downloadTemplate('inventory')"><i class="fas fa-download"></i> تحميل </button></div><div class="template-card"><h3>قالب الموردين</h3><p>لاستيراد بيانات الموردين</p><button type="button" class="btn" onclick="downloadTemplate('suppliers')"><i class="fas fa-download"></i> تحميل </button></div><div class="template-card"><h3>قالب العملاء</h3><p>لاستيراد بيانات العملاء</p><button type="button" class="btn" onclick="downloadTemplate('customers')"><i class="fas fa-download"></i> تحميل </button></div></div></div></div><!-- Progress Container --><div class="progress-container" id="progressContainer"><h2><i class="fas fa-spinner fa-spin"></i> جاري معالجة الملف... </h2><div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div><div id="progressText">جاري تحليل الملف...</div></div><!-- Results Container --><div class="results-container" id="resultsContainer"><h2><i class="fas fa-chart-bar"></i> نتائج الاستيراد </h2><div id="resultsContent"></div></div></div><script> let selectedFile = null; let analysisData = null; // Handle file selection function handleFileSelect(event) { const file = event.target.files[0]; if (file) { selectedFile = file; displayFileInfo(file); } } // Display file information function displayFileInfo(file) { const fileInfo = document.getElementById('fileInfo'); const fileDetails = document.getElementById('fileDetails'); fileDetails.innerHTML = ` <div><strong>اسم الملف:</strong> ${file.name}</div><div><strong>الحجم:</strong> ${(file.size / 1024 / 1024).toFixed(2)} ميجابايت</div><div><strong>النوع:</strong> ${file.type}</div><div><strong>آخر تعديل:</strong> ${new Date(file.lastModified).toLocaleDateString('ar-EG')}</div> `; fileInfo.style.display = 'block'; } // Upload file async function uploadFile() { if (!selectedFile) { showAlert('يرجى اختيار ملف أولاً', 'error'); return; } const formData = new FormData(); formData.append('file', selectedFile); showProgress('جاري رفع الملف...', 20); try { const response = await fetch('/api/upload-excel', { method: 'POST', body: formData }); const result = await response.json(); if (result.success) { analysisData = result.data; showProgress('جاري تحليل البيانات...', 60); setTimeout(() => { showAnalysisResults(result.data.analysis); hideProgress(); }, 1000); } else { hideProgress(); showAlert(result.message, 'error'); } } catch (error) { hideProgress(); showAlert('خطأ في رفع الملف: ' + error.message, 'error'); } } // Show analysis results function showAnalysisResults(analysis) { const resultsContainer = document.getElementById('resultsContainer'); const resultsContent = document.getElementById('resultsContent'); resultsContent.innerHTML = ` <div class="alert success"><i class="fas fa-check-circle"></i> تم تحليل الملف بنجاح! تم العثور على ${analysis.total_rows} صف و ${analysis.total_columns} عمود. </div><div class="stats-grid"><div class="stat-card"><div class="stat-number">${analysis.total_rows}</div><div class="stat-label">إجمالي الصفوف</div></div><div class="stat-card"><div class="stat-number">${analysis.total_columns}</div><div class="stat-label">إجمالي الأعمدة</div></div><div class="stat-card"><div class="stat-number">${analysis.detected_type}</div><div class="stat-label">نوع البيانات المكتشف</div></div></div><h3 style="margin: 20px 0;">الأعمدة المكتشفة:</h3><div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;"> ${analysis.columns.map(col => `<span style="background: #e9ecef; padding: 5px 10px; margin: 5px; border-radius: 5px; display: inline-block;">${col}</span>`).join('')} </div><h3 style="margin: 20px 0;">معاينة البيانات:</h3><div style="overflow-x: auto; margin-bottom: 20px;"><table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;"><thead style="background: #3498db; color: white;"><tr> ${analysis.columns.map(col => `<th style="padding: 10px; text-align: right;">${col}</th>`).join('')} </tr></thead><tbody> ${analysis.preview.map(row => ` <tr style="border-bottom: 1px solid #dee2e6;"> ${analysis.columns.map(col => `<td style="padding: 10px; text-align: right;">${row[col] || ''}</td>`).join('')} </tr> `).join('')} </tbody></table></div><div style="text-align: center;"><button type="button" class="btn success" onclick="importData()"><i class="fas fa-database"></i> استيراد البيانات </button><button type="button" class="btn warning" onclick="cancelImport()"><i class="fas fa-times"></i> إلغاء </button></div> `; resultsContainer.style.display = 'block'; } // Import data async function importData() { if (!analysisData) { showAlert('لا توجد بيانات للاستيراد', 'error'); return; } showProgress('جاري استيراد البيانات...', 0); try { const response = await fetch('/api/import-excel', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ filepath: analysisData.filepath, options: {} }) }); const result = await response.json(); if (result.success) { showProgress('تم الاستيراد بنجاح!', 100); setTimeout(() => { hideProgress(); showImportResults(result.data); }, 1000); } else { hideProgress(); showAlert(result.message, 'error'); } } catch (error) { hideProgress(); showAlert('خطأ في استيراد البيانات: ' + error.message, 'error'); } } // Show import results function showImportResults(stats) { const resultsContent = document.getElementById('resultsContent'); resultsContent.innerHTML = ` <div class="alert success"><i class="fas fa-check-circle"></i> تم استيراد البيانات بنجاح! </div><div class="stats-grid"><div class="stat-card"><div class="stat-number">${stats.imported_products}</div><div class="stat-label">المنتجات المستوردة</div></div><div class="stat-card"><div class="stat-number">${stats.imported_categories}</div><div class="stat-label">التصنيفات المستوردة</div></div><div class="stat-card"><div class="stat-number">${stats.imported_warehouses}</div><div class="stat-label">المخازن المستوردة</div></div><div class="stat-card"><div class="stat-number">${stats.imported_suppliers}</div><div class="stat-label">الموردين المستوردين</div></div><div class="stat-card"><div class="stat-number">${stats.imported_customers}</div><div class="stat-label">العملاء المستوردين</div></div><div class="stat-card"><div class="stat-number">${stats.total_rows}</div><div class="stat-label">إجمالي الصفوف المعالجة</div></div></div> ${stats.errors && stats.errors.length > 0 ? ` <div class="alert warning"><h4>تحذيرات:</h4><ul> ${stats.errors.map(error => `<li>${error}</li>`).join('')} </ul></div> ` : ''} <div style="text-align: center; margin-top: 20px;"><button type="button" class="btn" onclick="location.reload()"><i class="fas fa-redo"></i> استيراد ملف آخر </button><a href="/" class="btn success"><i class="fas fa-home"></i> العودة للرئيسية </a></div> `; } // Cancel import function cancelImport() { document.getElementById('resultsContainer').style.display = 'none'; document.getElementById('fileInfo').style.display = 'none'; document.getElementById('fileInput').value = ''; selectedFile = null; analysisData = null; } // Download template async function downloadTemplate(templateType) { try { const response = await fetch(`/api/export-template/${templateType}`); const result = await response.json(); if (result.success) { // Create download link const link = document.createElement('a'); link.href = result.data.download_url; link.download = result.data.filename; document.body.appendChild(link); link.click(); document.body.removeChild(link); showAlert('تم تحميل القالب بنجاح', 'success'); } else { showAlert(result.message, 'error'); } } catch (error) { showAlert('خطأ في تحميل القالب: ' + error.message, 'error'); } } // Show progress function showProgress(text, percentage) { const progressContainer = document.getElementById('progressContainer'); const progressFill = document.getElementById('progressFill'); const progressText = document.getElementById('progressText'); progressContainer.style.display = 'block'; progressFill.style.width = percentage + '%'; progressText.textContent = text; } // Hide progress function hideProgress() { document.getElementById('progressContainer').style.display = 'none'; } // Show alert function showAlert(message, type) { const alertDiv = document.createElement('div'); alertDiv.className = `alert ${type}`; alertDiv.innerHTML = ` <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i> ${message} `; document.querySelector('.container').insertBefore(alertDiv, document.querySelector('.main-content')); setTimeout(() => { alertDiv.remove(); }, 5000); } // Drag and drop functionality const uploadArea = document.querySelector('.upload-area'); uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); }); uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('dragover'); }); uploadArea.addEventListener('drop', (e) => { e.preventDefault(); uploadArea.classList.remove('dragover'); const files = e.dataTransfer.files; if (files.length > 0) { const file = files[0]; if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) { selectedFile = file; displayFileInfo(file); } else { showAlert('يرجى اختيار ملف Excel صحيح (.xlsx أو .xls)', 'error'); } } }); </script></body></html> 