<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>التصدير والطباعة - نظام إدارة المخزون</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style> body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; direction: rtl; } .container { padding: 2rem 0; } .export-card { background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 2rem; margin-bottom: 2rem; transition: transform 0.3s ease; } .export-card:hover { transform: translateY(-5px); } .export-header { text-align: center; margin-bottom: 2rem; } .export-header h1 { color: #333; margin-bottom: 0.5rem; } .export-header p { color: #666; margin: 0; } .export-section { margin-bottom: 3rem; } .section-title { color: #333; border-bottom: 2px solid #667eea; padding-bottom: 0.5rem; margin-bottom: 1.5rem; } .export-btn { width: 100%; padding: 1rem; margin-bottom: 1rem; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; transition: all 0.3s ease; position: relative; overflow: hidden; } .export-btn:before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s; } .export-btn:hover:before { left: 100%; } .btn-excel { background: linear-gradient(45deg, #1e7e34, #28a745); color: white; } .btn-excel:hover { background: linear-gradient(45deg, #155724, #1e7e34); color: white; transform: translateY(-2px); } .btn-pdf { background: linear-gradient(45deg, #dc3545, #e74c3c); color: white; } .btn-pdf:hover { background: linear-gradient(45deg, #c82333, #dc3545); color: white; transform: translateY(-2px); } .date-filter { background: #f8f9fa; border-radius: 10px; padding: 1.5rem; margin-bottom: 2rem; } .back-btn { position: fixed; top: 20px; right: 20px; z-index: 1000; background: rgba(255,255,255,0.9); border: none; border-radius: 50px; padding: 0.75rem 1.5rem; color: #333; text-decoration: none; transition: all 0.3s ease; } .back-btn:hover { background: white; color: #667eea; transform: translateY(-2px); } .loading { display: none; text-align: center; padding: 2rem; } .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .alert { border-radius: 10px; border: none; } .icon-large { font-size: 1.5rem; margin-left: 0.5rem; } </style></head><body><a href="/" class="back-btn"><i class="fas fa-arrow-right"></i> العودة للرئيسية </a><div class="container"><div class="export-card"><div class="export-header"><h1><i class="fas fa-download"></i> التصدير والطباعة</h1><p>تصدير البيانات والتقارير بصيغ مختلفة</p></div><!-- فلتر التاريخ --><div class="date-filter"><h5><i class="fas fa-calendar-alt"></i> فلتر التاريخ (للحركات)</h5><div class="row"><div class="col-md-6"><label for="startDate" class="form-label">من تاريخ:</label><input type="date" class="form-control" id="startDate"></div><div class="col-md-6"><label for="endDate" class="form-label">إلى تاريخ:</label><input type="date" class="form-control" id="endDate"></div></div></div><!-- تصدير المنتجات --><div class="export-section"><h3 class="section-title"><i class="fas fa-boxes"></i> المنتجات</h3><div class="row"><div class="col-md-6"><button type="button" class="export-btn btn-excel" onclick="exportData('products', 'excel')"><i class="fas fa-file-excel icon-large"></i> تصدير المنتجات إلى Excel </button></div><div class="col-md-6"><button type="button" class="export-btn btn-pdf" onclick="exportData('products', 'pdf')" disabled><i class="fas fa-file-pdf icon-large"></i> تصدير المنتجات إلى PDF (قريباً) </button></div></div></div><!-- تصدير تقرير المخزون --><div class="export-section"><h3 class="section-title"><i class="fas fa-warehouse"></i> تقرير المخزون</h3><div class="row"><div class="col-md-6"><button type="button" class="export-btn btn-excel" onclick="exportData('inventory', 'excel')"><i class="fas fa-file-excel icon-large"></i> تصدير تقرير المخزون إلى Excel </button></div><div class="col-md-6"><button type="button" class="export-btn btn-pdf" onclick="exportData('inventory', 'pdf')"><i class="fas fa-file-pdf icon-large"></i> تصدير تقرير المخزون إلى PDF </button></div></div></div><!-- تصدير حركات المخزون --><div class="export-section"><h3 class="section-title"><i class="fas fa-exchange-alt"></i> حركات المخزون</h3><div class="row"><div class="col-md-6"><button type="button" class="export-btn btn-excel" onclick="exportData('movements', 'excel')"><i class="fas fa-file-excel icon-large"></i> تصدير حركات المخزون إلى Excel </button></div><div class="col-md-6"><button type="button" class="export-btn btn-pdf" onclick="exportData('movements', 'pdf')" disabled><i class="fas fa-file-pdf icon-large"></i> تصدير حركات المخزون إلى PDF (قريباً) </button></div></div></div><!-- تصدير العملاء --><div class="export-section"><h3 class="section-title"><i class="fas fa-users"></i> العملاء</h3><div class="row"><div class="col-md-6"><button type="button" class="export-btn btn-excel" onclick="exportData('customers', 'excel')"><i class="fas fa-file-excel icon-large"></i> تصدير العملاء إلى Excel </button></div><div class="col-md-6"><button type="button" class="export-btn btn-pdf" onclick="exportData('customers', 'pdf')" disabled><i class="fas fa-file-pdf icon-large"></i> تصدير العملاء إلى PDF (قريباً) </button></div></div></div><!-- تصدير الموردين --><div class="export-section"><h3 class="section-title"><i class="fas fa-truck"></i> الموردين</h3><div class="row"><div class="col-md-6"><button type="button" class="export-btn btn-excel" onclick="exportData('suppliers', 'excel')"><i class="fas fa-file-excel icon-large"></i> تصدير الموردين إلى Excel </button></div><div class="col-md-6"><button type="button" class="export-btn btn-pdf" onclick="exportData('suppliers', 'pdf')" disabled><i class="fas fa-file-pdf icon-large"></i> تصدير الموردين إلى PDF (قريباً) </button></div></div></div><!-- منطقة التحميل --><div class="loading" id="loadingDiv"><div class="spinner"></div><p>جاري تحضير الملف...</p></div><!-- منطقة الرسائل --><div id="messageArea"></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script><script> // دالة التصدير الرئيسية async function exportData(type, format) { const loadingDiv = document.getElementById('loadingDiv'); const messageArea = document.getElementById('messageArea'); // إظهار التحميل loadingDiv.style.display = 'block'; messageArea.innerHTML = ''; try { // بناء URL let url = `/api/export/${type}/${format}`; // إضافة فلتر التاريخ للحركات if (type === 'movements') { const startDate = document.getElementById('startDate').value; const endDate = document.getElementById('endDate').value; const params = new URLSearchParams(); if (startDate) params.append('start_date', startDate); if (endDate) params.append('end_date', endDate); if (params.toString()) { url += '?' + params.toString(); } } // إرسال الطلب const response = await fetch(url, { method: 'GET', credentials: 'include' }); if (!response.ok) { const errorData = await response.json(); throw new Error(errorData.error || 'خطأ في التصدير'); } // تحميل الملف const blob = await response.blob(); const downloadUrl = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.style.display = 'none'; a.href = downloadUrl; // تحديد اسم الملف من header أو إنشاء اسم افتراضي const contentDisposition = response.headers.get('Content-Disposition'); let filename = `${type}_${format}_${new Date().toISOString().slice(0,10)}.${format === 'excel' ? 'xlsx' : 'pdf'}`; if (contentDisposition) { const filenameMatch = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/); if (filenameMatch && filenameMatch[1]) { filename = filenameMatch[1].replace(/['"]/g, ''); } } a.download = filename; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(downloadUrl); document.body.removeChild(a); // رسالة نجاح showMessage('تم تحميل الملف بنجاح!', 'success'); } catch (error) { console.error('خطأ في التصدير:', error); showMessage(`خطأ في التصدير: ${error.message}`, 'danger'); } finally { // إخفاء التحميل loadingDiv.style.display = 'none'; } } // دالة عرض الرسائل function showMessage(message, type) { const messageArea = document.getElementById('messageArea'); messageArea.innerHTML = ` <div class="alert alert-${type} alert-dismissible fade show" role="alert"> ${message} <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="إغلاق" title="إغلاق النافذة" ></button></div> `; // إخفاء الرسالة تلقائياً بعد 5 ثوان setTimeout(() => { const alert = messageArea.querySelector('.alert'); if (alert) { alert.remove(); } }, 5000); } // تعيين التاريخ الافتراضي (آخر شهر) document.addEventListener('DOMContentLoaded', function() { const today = new Date(); const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate()); document.getElementById('endDate').value = today.toISOString().slice(0, 10); document.getElementById('startDate').value = lastMonth.toISOString().slice(0, 10); }); </script></body></html> 