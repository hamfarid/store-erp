<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© - Ù†Ø¸Ø§Ù… ERP Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            direction: rtl;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: inline-block;
        }

        .tabs-container {
            background: white;
            border-radius: 15px;
            margin-bottom: 25px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 18px 15px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            color: #6c757d;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            background: white;
            color: #3498db;
            border-bottom-color: #3498db;
        }

        .content {
            padding: 30px;
            min-height: 600px;
        }

        .section {
            background: #f8f9fa;
            margin-bottom: 25px;
            padding: 25px;
            border-radius: 12px;
            border-right: 5px solid #3498db;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 8px;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
        }

        .button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .button.success {
            background: #27ae60;
            box-shadow: 0 3px 10px rgba(39, 174, 96, 0.3);
        }

        .button.success:hover {
            background: #229954;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .button.danger {
            background: #e74c3c;
            box-shadow: 0 3px 10px rgba(231, 76, 60, 0.3);
        }

        .button.danger:hover {
            background: #c0392b;
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .button.warning {
            background: #f39c12;
            box-shadow: 0 3px 10px rgba(243, 156, 18, 0.3);
        }

        .button.warning:hover {
            background: #e67e22;
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }

        .result.success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .result.info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .result.warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.95em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-top: 4px solid #3498db;
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.95em;
            font-weight: 500;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .table th,
        .table td {
            padding: 15px 12px;
            text-align: right;
            border-bottom: 1px solid #f1f3f4;
        }

        .table th {
            background: #3498db;
            color: white;
            font-weight: 600;
            font-size: 0.95em;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .table tr:last-child td {
            border-bottom: none;
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-align: center;
            display: inline-block;
            min-width: 80px;
        }

        .status.active {
            background: #d4edda;
            color: #155724;
        }

        .status.inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status.completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-right: 5px solid;
        }

        .alert.info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .alert.warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert.success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .alert.error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¢ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</h1>
            <p class="subtitle">Ù†Ø¸Ø§Ù… ERP Ø´Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„ÙƒØ§Ù…Ù„</p>

            <div>
                <button class="button" onclick="checkSystemHealth()">ğŸ” ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                <button class="button success" onclick="loginAsAdmin()">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</button>
                <button class="button warning" onclick="refreshAllData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>

            <div id="user-info" class="user-info hidden">
                <strong>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> <span id="user-name"></span> |
                <strong>Ø§Ù„Ø¯ÙˆØ±:</strong> <span id="user-role"></span> |
                <strong>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:</strong> <span id="user-permissions-count"></span>
            </div>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" onclick="showTab('dashboard')">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
                <button class="tab" onclick="showTab('products')">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</button>
                <button class="tab" onclick="showTab('batches')">ğŸ·ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„ÙˆØ·Ø§Øª</button>
                <button class="tab" onclick="showTab('reports')">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</button>
                <button class="tab" onclick="showTab('import-export')">ğŸ“ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯/Ø§Ù„ØªØµØ¯ÙŠØ±</button>
                <button class="tab" onclick="showTab('permissions')">ğŸ” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
                <button class="tab" onclick="showTab('settings')">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</button>
            </div>

            <div class="content">
                <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
                <div id="dashboard-tab" class="tab-content">
                    <div class="section">
                        <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h3>
                        <button class="button" onclick="loadDashboardStats()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                        <div id="dashboard-stats" class="stats-grid"></div>
                        <div id="dashboard-result" class="result"></div>
                    </div>
                </div>

                <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø© -->
                <div id="products-tab" class="tab-content hidden">
                    <div class="section">
                        <h3>ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø©</h3>
                        <p><strong>Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‡Ø±Ù…ÙŠ:</strong> Ø§Ù„ØªØµÙ†ÙŠÙ â†’ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ù†ØªØ¬ â†’ Ø§Ù„Ù…Ø±ØªØ¨Ø© â†’ Ø£ØµÙ†Ø§Ù â†’ Ø§Ù„Ù…Ù†ØªØ¬ â†’ Ø§Ù„Ù…ÙˆØ±Ø¯</p>
                        <button class="button" onclick="loadIntegratedProducts()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</button>
                        <button class="button success" onclick="showAddProductForm()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</button>
                        <div id="products-result" class="result"></div>
                    </div>
                </div>

                <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„ÙˆØ·Ø§Øª -->
                <div id="batches-tab" class="tab-content hidden">
                    <div class="section">
                        <h3>ğŸ·ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„ÙˆØ·Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h3>
                        <div class="grid">
                            <div class="form-group">
                                <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…Ø®Ø²Ù†:</label>
                                <select id="warehouse-filter">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø®Ø§Ø²Ù†</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ÙÙ„ØªØ±Ø© Ø­Ø³Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©:</label>
                                <select id="expiry-filter">
                                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
                                    <option value="valid">ØµØ§Ù„Ø­</option>
                                    <option value="expiring">Ù‚Ø±ÙŠØ¨ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</option>
                                    <option value="expired">Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</option>
                                </select>
                            </div>
                        </div>
                        <button class="button" onclick="loadIntegratedBatches()">Ø¹Ø±Ø¶ Ø§Ù„Ù„ÙˆØ·Ø§Øª</button>
                        <button class="button success" onclick="showAddBatchForm()">Ø¥Ø¶Ø§ÙØ© Ù„ÙˆØ· Ø¬Ø¯ÙŠØ¯</button>
                        <div id="batches-result" class="result"></div>
                    </div>
                </div>

                <!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
                <div id="reports-tab" class="tab-content hidden">
                    <div class="section">
                        <h3>ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©</h3>
                        <div class="grid">
                            <div class="form-group">
                                <label>ÙØªØ±Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</label>
                                <select id="report-period">
                                    <option value="current_month">Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</option>
                                    <option value="last_month">Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ</option>
                                    <option value="quarter">Ø§Ù„Ø±Ø¨Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</option>
                                    <option value="custom">ÙØªØ±Ø© Ù…Ø®ØµØµØ©</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</label>
                                <select id="report-type">
                                    <option value="summary">Ù…Ù„Ø®Øµ Ø´Ø§Ù…Ù„</option>
                                    <option value="detailed">ØªÙØµÙŠÙ„ÙŠ</option>
                                    <option value="analysis">ØªØ­Ù„ÙŠÙ„ÙŠ</option>
                                </select>
                            </div>
                        </div>
                        <button class="button" onclick="loadFinancialReports()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</button>
                        <button class="button success" onclick="exportFinancialReport()">ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                        <div id="financial-result" class="result"></div>
                    </div>
                </div>

                <!-- Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯/Ø§Ù„ØªØµØ¯ÙŠØ± -->
                <div id="import-export-tab" class="tab-content hidden">
                    <div class="section">
                        <h3>ğŸ“ Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ ÙˆØ§Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ØªØ·ÙˆØ±</h3>
                        <div class="grid">
                            <div>
                                <h4>ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                                <button class="button" onclick="exportData('products')">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
                                <button class="button" onclick="exportData('batches')">ØªØµØ¯ÙŠØ± Ø§Ù„Ù„ÙˆØ·Ø§Øª</button>
                                <button class="button" onclick="exportData('suppliers')">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button>
                                <button class="button" onclick="exportData('warehouses')">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø®Ø§Ø²Ù†</button>
                            </div>
                            <div>
                                <h4>ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h4>
                                <input type="file" id="import-file" accept=".xlsx,.csv" style="margin-bottom: 10px;">
                                <button class="button success" onclick="importData()">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù</button>
                            </div>
                        </div>
                        <div id="import-export-result" class="result"></div>
                    </div>

                    <div class="section">
                        <h3>ğŸ“‹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ù…ÙØµÙ„Ø©</h3>
                        <button class="button" onclick="loadImportExportLogs()">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</button>
                        <button class="button danger" onclick="clearOldLogs()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©</button>
                        <div id="logs-result" class="result"></div>
                    </div>
                </div>

                <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
                <div id="permissions-tab" class="tab-content hidden">
                    <div class="section">
                        <h3>ğŸ” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h3>
                        <button class="button" onclick="loadRoles()">Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¯ÙˆØ§Ø±</button>
                        <button class="button" onclick="loadUsers()">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</button>
                        <button class="button success" onclick="showCreateRoleForm()">Ø¥Ù†Ø´Ø§Ø¡ Ø¯ÙˆØ± Ø¬Ø¯ÙŠØ¯</button>
                        <div id="permissions-result" class="result"></div>
                    </div>

                    <div class="section">
                        <h3>ğŸ‘¤ ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                        <div class="grid">
                            <div class="form-group">
                                <label>Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                                <input type="number" id="user-id" placeholder="Ø£Ø¯Ø®Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label>
                                <select id="user-role-select">
                                    <option value="1">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</option>
                                    <option value="2">Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</option>
                                    <option value="3">Ù…ÙˆØ¸Ù Ù…Ø¨ÙŠØ¹Ø§Øª</option>
                                </select>
                            </div>
                        </div>
                        <button class="button" onclick="updateUserPermissions()">ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
                        <div id="user-permissions-result" class="result"></div>
                    </div>
                </div>

                <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© -->
                <div id="settings-tab" class="tab-content hidden">
                    <div class="section">
                        <h3>ğŸ¢ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                        <button class="button" onclick="loadCompanySettings()">ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</button>
                        <button class="button success" onclick="saveCompanySettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                        <button class="button warning" onclick="resetCompanySettings()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>

                        <div class="grid">
                            <div class="form-group">
                                <label>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© (Ø¹Ø±Ø¨ÙŠ):</label>
                                <input type="text" id="company-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ© (Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ):</label>
                                <input type="text" id="company-name-en" placeholder="Company Name">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
                                <textarea id="company-address" rows="3" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø±ÙƒØ©"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                                <input type="tel" id="company-phone" placeholder="+20123456789">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                                <input type="email" id="company-email" placeholder="info@company.com">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
                                <input type="url" id="company-website" placeholder="www.company.com">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ:</label>
                                <input type="text" id="tax-number" placeholder="123456789">
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ¬Ø§Ø±ÙŠ:</label>
                                <input type="text" id="commercial-register" placeholder="CR123456">
                            </div>
                        </div>
                        <div id="company-settings-result" class="result"></div>
                    </div>

                    <div class="section">
                        <h3>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø©</h3>
                        <button class="button" onclick="loadSystemSettings()">ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                        <button class="button success" onclick="saveSystemSettings()">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>

                        <div class="grid">
                            <div class="form-group">
                                <label>Ø§Ù„Ø¹Ù…Ù„Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:</label>
                                <select id="default-currency">
                                    <option value="EGP">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ (EGP)</option>
                                    <option value="USD">Ø¯ÙˆÙ„Ø§Ø± Ø£Ù…Ø±ÙŠÙƒÙŠ (USD)</option>
                                    <option value="EUR">ÙŠÙˆØ±Ùˆ (EUR)</option>
                                    <option value="SAR">Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ (SAR)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©:</label>
                                <select id="default-language">
                                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©:</label>
                                <select id="timezone">
                                    <option value="Africa/Cairo">Ø§Ù„Ù‚Ø§Ù‡Ø±Ø© (GMT+2)</option>
                                    <option value="Asia/Riyadh">Ø§Ù„Ø±ÙŠØ§Ø¶ (GMT+3)</option>
                                    <option value="Asia/Dubai">Ø¯Ø¨ÙŠ (GMT+4)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Ø­Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ù†Ø®ÙØ¶:</label>
                                <input type="number" id="low-stock-threshold" placeholder="10" min="1">
                            </div>
                            <div class="form-group">
                                <label>Ù…Ù‡Ù„Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© (Ø¯Ù‚ÙŠÙ‚Ø©):</label>
                                <input type="number" id="session-timeout" placeholder="30" min="5" max="480">
                            </div>
                            <div class="form-group">
                                <label>ØªÙƒØ±Ø§Ø± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ:</label>
                                <select id="backup-frequency">
                                    <option value="daily">ÙŠÙˆÙ…ÙŠ</option>
                                    <option value="weekly">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
                                    <option value="monthly">Ø´Ù‡Ø±ÙŠ</option>
                                </select>
                            </div>
                        </div>
                        <div id="system-settings-result" class="result"></div>
                    </div>

                    <div class="section">
                        <h3>ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
                        <button class="button" onclick="getSettingsStats()">Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                        <div id="settings-stats" class="stats-grid"></div>
                        <div id="settings-stats-result" class="result"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'http://localhost:8007';
        let authToken = null;
        let currentUser = null;

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });

            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯
            document.getElementById(tabName + '-tab').classList.remove('hidden');

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù†Ø´Ø·Ø© Ù„Ù„Ø²Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
            event.target.classList.add('active');
        }

        // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        async function checkSystemHealth() {
            try {
                showLoading('dashboard-result');
                const response = await fetch(`${BACKEND_URL}/api/health`);
                const data = await response.json();

                document.getElementById('dashboard-result').textContent =
                    `âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…: ${data.status}\n${JSON.stringify(data, null, 2)}`;
                document.getElementById('dashboard-result').className = 'result success';
            } catch (error) {
                document.getElementById('dashboard-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`;
                document.getElementById('dashboard-result').className = 'result error';
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function loginAsAdmin() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    authToken = data.token;
                    currentUser = data.user;

                    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                    document.getElementById('user-name').textContent = currentUser.name;
                    document.getElementById('user-role').textContent = currentUser.role_ar;
                    document.getElementById('user-permissions-count').textContent =
                        Object.keys(currentUser.permissions).length + ' ÙˆØ­Ø¯Ø©';
                    document.getElementById('user-info').classList.remove('hidden');

                    showAlert('success', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                } else {
                    showAlert('error', `Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ${data.error}`);
                }
            } catch (error) {
                showAlert('error', `Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`);
            }
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„
        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div class="loading"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            element.className = 'result info';
        }

        // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.textContent = message;

            document.querySelector('.header').appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
        async function loadIntegratedProducts() {
            try {
                showLoading('products-result');
                const response = await fetch(`${BACKEND_URL}/api/products/integrated`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    let productsTable = `âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ${data.count} Ù…Ù†ØªØ¬ Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª\n\n`;
                    productsTable += 'Ø§Ù„Ù…Ø¹Ø±Ù | Ø§Ù„ØªØµÙ†ÙŠÙ | Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù…Ù†ØªØ¬ | Ø§Ù„Ù…Ù†ØªØ¬ | Ø§Ù„Ù…ÙˆØ±Ø¯ | Ø¹Ø¯Ø¯ Ø§Ù„Ù„ÙˆØ·Ø§Øª | Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†\n';
                    productsTable += ''.padEnd(100, '-') + '\n';

                    data.products.forEach(product => {
                        productsTable += `${product.id} | ${product.Ø§Ù„ØªØµÙ†ÙŠÙ} | ${product.Ù…Ø¬Ù…ÙˆØ¹Ù‡_Ø§Ù„Ù…Ù†ØªØ¬ || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | ${product.Ø§Ù„Ù…Ù†ØªØ¬} | ${product.supplier_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | ${product.batch_count || 0} | ${product.total_stock || 0}\n`;
                    });

                    document.getElementById('products-result').textContent = productsTable;
                    document.getElementById('products-result').className = 'result success';
                } else {
                    document.getElementById('products-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('products-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('products-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`;
                document.getElementById('products-result').className = 'result error';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ÙˆØ·Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
        async function loadIntegratedBatches() {
            try {
                showLoading('batches-result');
                const warehouseFilter = document.getElementById('warehouse-filter').value;
                const expiryFilter = document.getElementById('expiry-filter').value;

                let url = `${BACKEND_URL}/api/batches/integrated?`;
                if (warehouseFilter) url += `warehouse_id=${warehouseFilter}&`;
                if (expiryFilter) url += `expiry_status=${expiryFilter}&`;

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    let batchesTable = `âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ${data.count} Ù„ÙˆØ·\n\n`;
                    batchesTable += 'Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ· | Ø§Ù„Ù…Ù†ØªØ¬ | Ø§Ù„Ù…Ø®Ø²Ù† | Ø§Ù„ÙƒÙ…ÙŠØ© | ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ | Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©\n';
                    batchesTable += ''.padEnd(100, '-') + '\n';

                    data.batches.forEach(batch => {
                        batchesTable += `${batch.Ø±Ù‚Ù…_Ø§Ù„Ù„ÙˆØ·} | ${batch.product_name} | ${batch.warehouse_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | ${batch.Ø§Ù„ÙƒÙ…ÙŠÙ‡_Ø§Ù„Ù…ØªÙˆØ§ÙØ±Ù‡} | ${batch.ØªØ§Ø±ÙŠØ®_Ø§Ù„Ø¥Ù†ØªÙ‡Ø§Ø¡ || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} | ${batch.expiry_status_calc}\n`;
                    });

                    document.getElementById('batches-result').textContent = batchesTable;
                    document.getElementById('batches-result').className = 'result success';
                } else {
                    document.getElementById('batches-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('batches-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('batches-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`;
                document.getElementById('batches-result').className = 'result error';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
        async function loadFinancialReports() {
            try {
                showLoading('financial-result');
                const period = document.getElementById('report-period').value;
                const type = document.getElementById('report-type').value;

                const response = await fetch(`${BACKEND_URL}/api/reports/financial/integrated?period=${period}&type=${type}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    const report = data.financial_report;
                    let reportText = `âœ… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©\n`;
                    reportText += `ğŸ“… Ø§Ù„ÙØªØ±Ø©: ${report.period}\n\n`;

                    // Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                    if (report.inventory_summary) {
                        reportText += `ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:\n`;
                        reportText += `   â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${report.inventory_summary.total_products || 0}\n`;
                        reportText += `   â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„ÙˆØ·Ø§Øª: ${report.inventory_summary.total_batches || 0}\n`;
                        reportText += `   â€¢ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${(report.inventory_summary.total_inventory_value || 0).toFixed(2)} Ø¬Ù†ÙŠÙ‡\n`;
                        reportText += `   â€¢ Ù„ÙˆØ·Ø§Øª Ù…Ù†ØªÙ‡ÙŠØ© Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${report.inventory_summary.expired_batches || 0}\n`;
                        reportText += `   â€¢ Ù„ÙˆØ·Ø§Øª Ù‚Ø±ÙŠØ¨Ø© Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${report.inventory_summary.expiring_batches || 0}\n\n`;
                    }

                    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
                    if (report.category_breakdown && report.category_breakdown.length > 0) {
                        reportText += `ğŸ“¦ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª:\n`;
                        report.category_breakdown.forEach(category => {
                            reportText += `   â€¢ ${category.Ø§Ù„ØªØµÙ†ÙŠÙ}: ${category.product_count} Ù…Ù†ØªØ¬ØŒ Ù‚ÙŠÙ…Ø©: ${(category.total_value || 0).toFixed(2)} Ø¬Ù†ÙŠÙ‡\n`;
                        });
                        reportText += '\n';
                    }

                    // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø²Ù†
                    if (report.warehouse_analysis && report.warehouse_analysis.length > 0) {
                        reportText += `ğŸª ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø²Ù†:\n`;
                        report.warehouse_analysis.forEach(warehouse => {
                            reportText += `   â€¢ ${warehouse.name}: ${warehouse.batch_count} Ù„ÙˆØ·ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù…: ${(warehouse.utilization_percentage || 0).toFixed(1)}%\n`;
                        });
                        reportText += '\n';
                    }

                    // Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
                    if (report.alerts && report.alerts.length > 0) {
                        reportText += `âš ï¸ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª:\n`;
                        report.alerts.forEach(alert => {
                            reportText += `   â€¢ ${alert.message}\n`;
                        });
                        reportText += '\n';
                    }

                    // Ø§Ù„ØªÙˆØµÙŠØ§Øª
                    if (report.recommendations && report.recommendations.length > 0) {
                        reportText += `ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ§Øª:\n`;
                        report.recommendations.forEach(rec => {
                            reportText += `   â€¢ ${rec.message}\n`;
                        });
                    }

                    document.getElementById('financial-result').textContent = reportText;
                    document.getElementById('financial-result').className = 'result success';
                } else {
                    document.getElementById('financial-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('financial-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('financial-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©: ${error.message}`;
                document.getElementById('financial-result').className = 'result error';
            }
        }

        // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
        async function exportData(type) {
            try {
                showLoading('import-export-result');

                const response = await fetch(`${BACKEND_URL}/api/export/integrated`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        type: type,
                        format: 'excel',
                        include_relations: true
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${type}_export_${new Date().toISOString().slice(0,10)}.xlsx`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);

                    document.getElementById('import-export-result').textContent =
                        `âœ… ØªÙ… ØªØµØ¯ÙŠØ± ${type} Ø¨Ù†Ø¬Ø§Ø­`;
                    document.getElementById('import-export-result').className = 'result success';
                } else {
                    const data = await response.json();
                    document.getElementById('import-export-result').textContent =
                        `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±: ${data.error}`;
                    document.getElementById('import-export-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('import-export-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${error.message}`;
                document.getElementById('import-export-result').className = 'result error';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯/Ø§Ù„ØªØµØ¯ÙŠØ±
        async function loadImportExportLogs() {
            try {
                showLoading('logs-result');
                const response = await fetch(`${BACKEND_URL}/api/import-export/logs/integrated`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    let logsTable = `âœ… ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ${data.count} Ø³Ø¬Ù„\n\n`;
                    logsTable += 'Ø§Ù„Ù…Ø¹Ø±Ù | Ø§Ù„Ù†ÙˆØ¹ | Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | Ø§Ù„Ø­Ø§Ù„Ø© | Ø§Ù„Ø³Ø¬Ù„Ø§Øª | Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ | ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© | Ø§Ù„ØªØ§Ø±ÙŠØ®\n';
                    logsTable += ''.padEnd(120, '-') + '\n';

                    data.logs.forEach(log => {
                        const processingTime = log.processing_time_seconds ? `${log.processing_time_seconds.toFixed(1)}Ø«` : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        logsTable += `${log.id} | ${log.operation_type} | ${log.data_type} | ${log.status} | ${log.records_total || 0} | ${log.success_rate.toFixed(1)}% | ${processingTime} | ${log.started_at}\n`;
                    });

                    document.getElementById('logs-result').textContent = logsTable;
                    document.getElementById('logs-result').className = 'result success';
                } else {
                    document.getElementById('logs-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('logs-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('logs-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª: ${error.message}`;
                document.getElementById('logs-result').className = 'result error';
            }
        }

        // ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function updateUserPermissions() {
            const userId = document.getElementById('user-id').value;
            const roleId = document.getElementById('user-role-select').value;

            if (!userId) {
                showAlert('warning', 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…');
                return;
            }

            try {
                showLoading('user-permissions-result');

                const response = await fetch(`${BACKEND_URL}/api/users/${userId}/permissions/integrated`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        role_id: roleId,
                        custom_permissions: {
                            products: ['read', 'update'],
                            batches: ['read', 'update'],
                            reports: ['read']
                        },
                        custom_screens: ['dashboard', 'products', 'batches'],
                        warehouse_access: [1, 2] // Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„ÙŠÙ‡Ø§
                    })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('user-permissions-result').textContent =
                        `âœ… ${data.message}`;
                    document.getElementById('user-permissions-result').className = 'result success';
                    showAlert('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    document.getElementById('user-permissions-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('user-permissions-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('user-permissions-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`;
                document.getElementById('user-permissions-result').className = 'result error';
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function refreshAllData() {
            showAlert('info', 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');

            if (authToken) {
                await loadIntegratedProducts();
                await loadIntegratedBatches();
                await loadFinancialReports();
                await loadImportExportLogs();
                await loadCompanySettings();
                await loadSystemSettings();
            }

            showAlert('success', 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©
        async function loadCompanySettings() {
            try {
                showLoading('company-settings-result');
                const response = await fetch(`${BACKEND_URL}/api/settings/company`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    document.getElementById('company-name').value = data.data.company_name || '';
                    document.getElementById('company-name-en').value = data.data.company_name_en || '';
                    document.getElementById('company-address').value = data.data.company_address || '';
                    document.getElementById('company-phone').value = data.data.company_phone || '';
                    document.getElementById('company-email').value = data.data.company_email || '';
                    document.getElementById('company-website').value = data.data.company_website || '';
                    document.getElementById('tax-number').value = data.data.tax_number || '';
                    document.getElementById('commercial-register').value = data.data.commercial_register || '';

                    document.getElementById('company-settings-result').textContent =
                        'âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­';
                    document.getElementById('company-settings-result').className = 'result success';
                } else {
                    document.getElementById('company-settings-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('company-settings-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('company-settings-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©: ${error.message}`;
                document.getElementById('company-settings-result').className = 'result error';
            }
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©
        async function saveCompanySettings() {
            try {
                showLoading('company-settings-result');

                const companyData = {
                    company_name: document.getElementById('company-name').value,
                    company_name_en: document.getElementById('company-name-en').value,
                    company_address: document.getElementById('company-address').value,
                    company_phone: document.getElementById('company-phone').value,
                    company_email: document.getElementById('company-email').value,
                    company_website: document.getElementById('company-website').value,
                    tax_number: document.getElementById('tax-number').value,
                    commercial_register: document.getElementById('commercial-register').value
                };

                const response = await fetch(`${BACKEND_URL}/api/settings/company`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(companyData)
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('company-settings-result').textContent =
                        'âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­';
                    document.getElementById('company-settings-result').className = 'result success';
                    showAlert('success', 'ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    document.getElementById('company-settings-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('company-settings-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('company-settings-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©: ${error.message}`;
                document.getElementById('company-settings-result').className = 'result error';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        async function loadSystemSettings() {
            try {
                showLoading('system-settings-result');
                const response = await fetch(`${BACKEND_URL}/api/settings/system`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    const settings = data.data;

                    if (settings.financial) {
                        document.getElementById('default-currency').value = settings.financial.default_currency || 'EGP';
                    }
                    if (settings.system) {
                        document.getElementById('default-language').value = settings.system.default_language || 'ar';
                        document.getElementById('timezone').value = settings.system.timezone || 'Africa/Cairo';
                        document.getElementById('session-timeout').value = settings.security?.session_timeout || 30;
                        document.getElementById('backup-frequency').value = settings.system.backup_frequency || 'daily';
                    }
                    if (settings.inventory) {
                        document.getElementById('low-stock-threshold').value = settings.inventory.low_stock_threshold || 10;
                    }

                    document.getElementById('system-settings-result').textContent =
                        'âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­';
                    document.getElementById('system-settings-result').className = 'result success';
                } else {
                    document.getElementById('system-settings-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('system-settings-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('system-settings-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…: ${error.message}`;
                document.getElementById('system-settings-result').className = 'result error';
            }
        }

        // Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        async function saveSystemSettings() {
            try {
                showLoading('system-settings-result');

                const systemData = {
                    financial: {
                        default_currency: document.getElementById('default-currency').value
                    },
                    system: {
                        default_language: document.getElementById('default-language').value,
                        timezone: document.getElementById('timezone').value,
                        backup_frequency: document.getElementById('backup-frequency').value
                    },
                    security: {
                        session_timeout: parseInt(document.getElementById('session-timeout').value)
                    },
                    inventory: {
                        low_stock_threshold: parseInt(document.getElementById('low-stock-threshold').value)
                    }
                };

                const response = await fetch(`${BACKEND_URL}/api/settings/system`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(systemData)
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('system-settings-result').textContent =
                        'âœ… ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­';
                    document.getElementById('system-settings-result').className = 'result success';
                    showAlert('success', 'ØªÙ… Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­');
                } else {
                    document.getElementById('system-settings-result').textContent =
                        `âŒ Ø®Ø·Ø£: ${data.error}`;
                    document.getElementById('system-settings-result').className = 'result error';
                }
            } catch (error) {
                document.getElementById('system-settings-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…: ${error.message}`;
                document.getElementById('system-settings-result').className = 'result error';
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©
        async function resetCompanySettings() {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©ØŸ')) {
                return;
            }

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            document.getElementById('company-name').value = 'Ø´Ø±ÙƒØ© Ø§Ù„Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©';
            document.getElementById('company-name-en').value = 'Modern Agriculture Company';
            document.getElementById('company-address').value = 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©ØŒ Ù…ØµØ±';
            document.getElementById('company-phone').value = '+20123456789';
            document.getElementById('company-email').value = 'info@modern-agri.com';
            document.getElementById('company-website').value = 'www.modern-agri.com';
            document.getElementById('tax-number').value = '123456789';
            document.getElementById('commercial-register').value = 'CR123456';

            showAlert('info', 'ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©');
        }

        // Ø¹Ø±Ø¶ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        async function getSettingsStats() {
            try {
                showLoading('settings-stats-result');

                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                const stats = {
                    total_settings: 15,
                    company_settings: 8,
                    system_settings: 7,
                    last_updated: new Date().toLocaleString('ar-EG')
                };

                // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙŠ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
                const statsGrid = document.getElementById('settings-stats');
                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${stats.total_settings}</div>
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.company_settings}</div>
                        <div class="stat-label">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ©</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${stats.system_settings}</div>
                        <div class="stat-label">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">âœ…</div>
                        <div class="stat-label">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</div>
                    </div>
                `;

                document.getElementById('settings-stats-result').textContent =
                    `âœ… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${stats.last_updated}`;
                document.getElementById('settings-stats-result').className = 'result success';

            } catch (error) {
                document.getElementById('settings-stats-result').textContent =
                    `âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª: ${error.message}`;
                document.getElementById('settings-stats-result').className = 'result error';
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            checkSystemHealth();
        };
    </script>
</body>
</html>