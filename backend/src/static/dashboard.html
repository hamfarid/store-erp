<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>لوحة المعلومات - نظام إدارة المخزون</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; direction: rtl; } .container { max-width: 1400px; margin: 0 auto; padding: 20px; } .header { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); } .header h1 { color: #2c3e50; font-size: 2.5rem; margin-bottom: 10px; } .header p { color: #7f8c8d; font-size: 1.1rem; } .stats-overview { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; } .stat-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); text-align: center; transition: transform 0.3s ease; } .stat-card:hover { transform: translateY(-5px); } .stat-card .icon { font-size: 3rem; margin-bottom: 15px; } .stat-card.products .icon { color: #3498db; } .stat-card.customers .icon { color: #2ecc71; } .stat-card.suppliers .icon { color: #e74c3c; } .stat-card.warehouses .icon { color: #f39c12; } .stat-card.movements .icon { color: #9b59b6; } .stat-card h3 { color: #2c3e50; font-size: 2.5rem; margin-bottom: 10px; } .stat-card p { color: #7f8c8d; font-size: 1.1rem; } .charts-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; } .chart-container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); } .chart-container h3 { color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.3rem; } .chart-canvas { max-height: 300px; } .activities-section { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; margin-bottom: 30px; } .activities-container, .alerts-container { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1); } .activities-container h3, .alerts-container h3 { color: #2c3e50; margin-bottom: 20px; text-align: center; font-size: 1.3rem; } .activity-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #ecf0f1; transition: background-color 0.3s ease; } .activity-item:hover { background-color: #f8f9fa; } .activity-item:last-child { border-bottom: none; } .activity-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-left: 15px; color: white; font-size: 1.2rem; } .activity-icon.in { background: #2ecc71; } .activity-icon.out { background: #e74c3c; } .activity-icon.adjustment { background: #f39c12; } .activity-details h4 { color: #2c3e50; margin-bottom: 5px; } .activity-details p { color: #7f8c8d; font-size: 0.9rem; } .alert-item { display: flex; align-items: center; padding: 15px; margin-bottom: 15px; border-radius: 10px; background: #fff5f5; border-right: 4px solid #e74c3c; } .alert-icon { color: #e74c3c; font-size: 1.5rem; margin-left: 15px; } .alert-details h4 { color: #c0392b; margin-bottom: 5px; } .alert-details p { color: #7f8c8d; font-size: 0.9rem; } .loading { text-align: center; padding: 50px; color: #7f8c8d; } .loading i { font-size: 3rem; margin-bottom: 20px; animation: spin 2s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .refresh-btn { position: fixed; bottom: 30px; left: 30px; background: #3498db; color: white; border: none; border-radius: 50%; width: 60px; height: 60px; font-size: 1.5rem; cursor: pointer; box-shadow: 0 5px 20px rgba(52, 152, 219, 0.3); transition: all 0.3s ease; } .refresh-btn:hover { transform: scale(1.1); background: #2980b9; } @media (max-width: 768px) { .charts-section { grid-template-columns: 1fr; } .activities-section { grid-template-columns: 1fr; } .stats-overview { grid-template-columns: repeat(2, 1fr); } } </style></head><body><div class="container"><!-- الرأس --><div class="header"><h1><i class="fas fa-chart-line"></i> لوحة المعلومات</h1><p>نظرة شاملة على أداء النظام والإحصائيات الحية</p></div><!-- الإحصائيات العامة --><div class="stats-overview"><div class="stat-card products"><div class="icon"><i class="fas fa-boxes"></i></div><h3 id="totalProducts">0</h3><p>إجمالي الأصناف</p></div><div class="stat-card customers"><div class="icon"><i class="fas fa-users"></i></div><h3 id="totalCustomers">0</h3><p>عدد العملاء</p></div><div class="stat-card suppliers"><div class="icon"><i class="fas fa-truck"></i></div><h3 id="totalSuppliers">0</h3><p>عدد الموردين</p></div><div class="stat-card warehouses"><div class="icon"><i class="fas fa-warehouse"></i></div><h3 id="totalWarehouses">0</h3><p>عدد المخازن</p></div><div class="stat-card movements"><div class="icon"><i class="fas fa-exchange-alt"></i></div><h3 id="recentMovements">0</h3><p>الحركات الأخيرة (30 يوم)</p></div></div><!-- الرسوم البيانية --><div class="charts-section"><div class="chart-container"><h3><i class="fas fa-chart-bar"></i> حركات المخزون (آخر 7 أيام)</h3><canvas id="movementsChart" class="chart-canvas"></canvas></div><div class="chart-container"><h3><i class="fas fa-chart-pie"></i> توزيع المخزون حسب المخازن</h3><canvas id="warehousesChart" class="chart-canvas"></canvas></div></div><!-- الأنشطة والتنبيهات --><div class="activities-section"><div class="activities-container"><h3><i class="fas fa-history"></i> الأنشطة الحديثة</h3><div id="activitiesList"><div class="loading"><i class="fas fa-spinner"></i><p>جاري تحميل الأنشطة...</p></div></div></div><div class="alerts-container"><h3><i class="fas fa-exclamation-triangle"></i> تنبيهات المخزون</h3><div id="alertsList"><div class="loading"><i class="fas fa-spinner"></i><p>جاري تحميل التنبيهات...</p></div></div></div></div></div><!-- زر التحديث --><button type="button" class="refresh-btn" onclick="refreshDashboard()" title="تحديث البيانات"><i class="fas fa-sync-alt"></i></button><script> let movementsChart = null; let warehousesChart = null; // تحميل البيانات عند تحميل الصفحة document.addEventListener('DOMContentLoaded', function() { loadDashboardData(); // تحديث البيانات كل 5 دقائق setInterval(loadDashboardData, 300000); }); async function loadDashboardData() { try { await Promise.all([ loadOverviewStats(), loadMovementsChart(), loadWarehousesChart(), loadRecentActivities(), loadLowStockAlerts() ]); } catch (error) { console.error('خطأ في تحميل بيانات لوحة المعلومات:', error); } } async function loadOverviewStats() { try { const response = await fetch('/api/stats/overview'); const result = await response.json(); if (result.success) { const data = result.data; document.getElementById('totalProducts').textContent = data.products.total; document.getElementById('totalCustomers').textContent = data.partners.customers; document.getElementById('totalSuppliers').textContent = data.partners.suppliers; document.getElementById('totalWarehouses').textContent = data.warehouses.total; document.getElementById('recentMovements').textContent = data.movements.recent; } } catch (error) { console.error('خطأ في تحميل الإحصائيات العامة:', error); } } async function loadMovementsChart() { try { const response = await fetch('/api/stats/movements/chart?days=7'); const result = await response.json(); if (result.success) { const ctx = document.getElementById('movementsChart').getContext('2d'); if (movementsChart) { movementsChart.destroy(); } const labels = result.data.map(item => { const date = new Date(item.date); return date.toLocaleDateString('ar-EG', { weekday: 'short', month: 'short', day: 'numeric' }); }); movementsChart = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [ { label: 'إدخال', data: result.data.map(item => item.in), backgroundColor: 'rgba(46, 204, 113, 0.8)', borderColor: 'rgba(46, 204, 113, 1)', borderWidth: 1 }, { label: 'إخراج', data: result.data.map(item => item.out), backgroundColor: 'rgba(231, 76, 60, 0.8)', borderColor: 'rgba(231, 76, 60, 1)', borderWidth: 1 }, { label: 'تعديل', data: result.data.map(item => item.adjustment), backgroundColor: 'rgba(243, 156, 18, 0.8)', borderColor: 'rgba(243, 156, 18, 1)', borderWidth: 1 } ] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top', } }, scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } } } }); } } catch (error) { console.error('خطأ في تحميل رسم حركات المخزون:', error); } } async function loadWarehousesChart() { try { const response = await fetch('/api/stats/warehouses/stock'); const result = await response.json(); if (result.success && result.data.length > 0) { const ctx = document.getElementById('warehousesChart').getContext('2d'); if (warehousesChart) { warehousesChart.destroy(); } const colors = [ 'rgba(52, 152, 219, 0.8)', 'rgba(46, 204, 113, 0.8)', 'rgba(231, 76, 60, 0.8)', 'rgba(243, 156, 18, 0.8)', 'rgba(155, 89, 182, 0.8)', 'rgba(26, 188, 156, 0.8)' ]; warehousesChart = new Chart(ctx, { type: 'doughnut', data: { labels: result.data.map(item => item.name), datasets: [{ data: result.data.map(item => item.product_count), backgroundColor: colors.slice(0, result.data.length), borderWidth: 2, borderColor: '#fff' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', } } } }); } } catch (error) { console.error('خطأ في تحميل رسم المخازن:', error); } } async function loadRecentActivities() { try { const response = await fetch('/api/stats/recent-activities?limit=10'); const result = await response.json(); if (result.success) { const activitiesList = document.getElementById('activitiesList'); if (result.data.length === 0) { activitiesList.innerHTML = '<p style="text-align: center; color: #7f8c8d; padding: 20px;">لا توجد أنشطة حديثة</p>'; return; } activitiesList.innerHTML = result.data.map(activity => ` <div class="activity-item"><div class="activity-icon ${activity.movement_type}"><i class="fas fa-${activity.movement_type === 'in' ? 'arrow-down' : activity.movement_type === 'out' ? 'arrow-up' : 'edit'}"></i></div><div class="activity-details"><h4>${activity.description}</h4><p>بواسطة ${activity.user} - ${activity.timestamp}</p></div></div> `).join(''); } } catch (error) { console.error('خطأ في تحميل الأنشطة الحديثة:', error); document.getElementById('activitiesList').innerHTML = '<p style="text-align: center; color: #e74c3c; padding: 20px;">خطأ في تحميل الأنشطة</p>'; } } async function loadLowStockAlerts() { try { const response = await fetch('/api/stats/low-stock'); const result = await response.json(); if (result.success) { const alertsList = document.getElementById('alertsList'); if (result.data.length === 0) { alertsList.innerHTML = '<p style="text-align: center; color: #27ae60; padding: 20px;"><i class="fas fa-check-circle"></i><br>جميع المنتجات في مستوى آمن</p>'; return; } alertsList.innerHTML = result.data.slice(0, 5).map(product => ` <div class="alert-item"><div class="alert-icon"><i class="fas fa-exclamation-triangle"></i></div><div class="alert-details"><h4>${product.name}</h4><p>الكمية الحالية: ${product.current_quantity} | الحد الأدنى: ${product.minimum_quantity}</p><p>المخزن: ${product.warehouse}</p></div></div> `).join(''); } } catch (error) { console.error('خطأ في تحميل تنبيهات المخزون:', error); document.getElementById('alertsList').innerHTML = '<p style="text-align: center; color: #e74c3c; padding: 20px;">خطأ في تحميل التنبيهات</p>'; } } function refreshDashboard() { const refreshBtn = document.querySelector('.refresh-btn i'); refreshBtn.style.animation = 'spin 1s linear infinite'; loadDashboardData().finally(() => { setTimeout(() => { refreshBtn.style.animation = ''; }, 1000); }); } </script></body></html> 