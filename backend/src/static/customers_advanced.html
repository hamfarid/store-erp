<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title><link rel="stylesheet" href="css/style.css"><link rel="stylesheet" href="css/navigation.css"><style> .customers-container { max-width: 1400px; margin: 20px auto; padding: 0 20px; } .page-header { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; } .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; } .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center; border-top: 4px solid; } .stat-card.total { border-top-color: #3498db; } .stat-card.vip { border-top-color: #f39c12; } .stat-card.active { border-top-color: #27ae60; } .stat-card.debt { border-top-color: #e74c3c; } .stat-number { font-size: 2.5em; font-weight: bold; margin-bottom: 10px; } .main-content { background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); overflow: hidden; } .content-header { background: #f8f9fa; padding: 25px 30px; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; } .search-filters { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; } .search-box { position: relative; min-width: 300px; } .search-input { width: 100%; padding: 12px 45px 12px 15px; border: 2px solid #e0e0e0; border-radius: 25px; font-size: 1em; transition: border-color 0.3s ease; } .search-input:focus { outline: none; border-color: #27ae60; } .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #7f8c8d; } .filter-select { padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; min-width: 150px; } .btn-group { display: flex; gap: 10px; } .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 500; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; } .btn-primary { background: #27ae60; color: white; } .btn-primary:hover { background: #229954; transform: translateY(-2px); } .btn-success { background: #3498db; color: white; } .btn-warning { background: #f39c12; color: white; } .btn-danger { background: #e74c3c; color: white; } .btn-sm { padding: 6px 12px; font-size: 0.9em; } .data-table { width: 100%; border-collapse: collapse; } .data-table th { background: #f8f9fa; padding: 15px; text-align: right; font-weight: 600; border-bottom: 2px solid #dee2e6; position: sticky; top: 0; z-index: 10; } .data-table td { padding: 15px; border-bottom: 1px solid #f0f0f0; vertical-align: middle; } .data-table tr:hover { background: #f8f9fa; } .customer-info { display: flex; align-items: center; gap: 12px; } .customer-avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #27ae60, #2ecc71); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.2em; } .customer-details h4 { margin: 0; font-size: 1.1em; color: #2c3e50; } .customer-details p { margin: 2px 0 0 0; font-size: 0.9em; color: #7f8c8d; } .category-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.9em; font-weight: 500; } .category-vip { background: #fff3cd; color: #856404; } .category-regular { background: #d1ecf1; color: #0c5460; } .category-wholesale { background: #d4edda; color: #155724; } .category-retail { background: #f8d7da; color: #721c24; } .category-corporate { background: #e2e3e5; color: #383d41; } .balance-indicator { display: flex; align-items: center; gap: 8px; } .balance-positive { color: #27ae60; font-weight: bold; } .balance-negative { color: #e74c3c; font-weight: bold; } .balance-zero { color: #7f8c8d; } .action-buttons { display: flex; gap: 8px; } .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; } .modal-content { background: white; margin: 2% auto; padding: 0; border-radius: 15px; max-width: 900px; max-height: 95vh; overflow-y: auto; } .modal-header { padding: 25px 30px; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; border-radius: 15px 15px 0 0; } .modal-body { padding: 30px; } .modal-footer { padding: 20px 30px; border-top: 1px solid #dee2e6; display: flex; justify-content: flex-end; gap: 10px; background: #f8f9fa; border-radius: 0 0 15px 15px; } .close-btn { background: none; border: none; font-size: 1.5em; cursor: pointer; color: #7f8c8d; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; } .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 25px; } .form-group { margin-bottom: 20px; } .form-label { display: block; margin-bottom: 8px; font-weight: 500; color: #2c3e50; } .form-control { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; transition: border-color 0.3s ease; } .form-control:focus { outline: none; border-color: #27ae60; } .tabs { display: flex; border-bottom: 2px solid #e0e0e0; margin-bottom: 25px; } .tab { padding: 12px 25px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s ease; font-weight: 500; } .tab.active { border-bottom-color: #27ae60; color: #27ae60; } .tab-content { display: none; } .tab-content.active { display: block; } .pagination { display: flex; justify-content: center; align-items: center; gap: 10px; padding: 20px; background: #f8f9fa; } .pagination button { padding: 8px 12px; border: 1px solid #dee2e6; background: white; cursor: pointer; border-radius: 4px; } .pagination button.active { background: #27ae60; color: white; border-color: #27ae60; } .empty-state { text-align: center; padding: 60px 20px; color: #7f8c8d; } .empty-state .icon { font-size: 4em; margin-bottom: 20px; } @media (max-width: 768px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .content-header { flex-direction: column; align-items: stretch; } .search-filters { flex-direction: column; } .search-box { min-width: auto; } .btn-group { justify-content: center; } .data-table { font-size: 0.9em; } .form-grid { grid-template-columns: 1fr; } } </style></head><body><div class="customers-container"><div class="page-header"><h1>ğŸ‘¥ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h1><p>Ø¥Ø¯Ø§Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ±Ø¨Ø·Ù‡Ù… Ø¨Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</p></div><div class="stats-grid"><div class="stat-card total"><div class="stat-number" id="totalCustomers">0</div><div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div></div><div class="stat-card vip"><div class="stat-number" id="vipCustomers">0</div><div class="stat-label">Ø¹Ù…Ù„Ø§Ø¡ VIP</div></div><div class="stat-card active"><div class="stat-number" id="activeCustomers">0</div><div class="stat-label">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</div></div><div class="stat-card debt"><div class="stat-number" id="totalDebt">0</div><div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</div></div></div><div class="main-content"><div class="content-header"><div class="search-filters"><div class="search-box"><input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ" class="search-input" placeholder="Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡..." id="searchInput" aria-label="Ø­Ù‚Ù„ Ù†Øµ"><span class="search-icon">ğŸ”</span></div><select class="filter-select" id="categoryFilter"><option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option><option value="vip">VIP</option><option value="regular">Ø¹Ø§Ø¯ÙŠ</option><option value="wholesale">Ø¬Ù…Ù„Ø©</option><option value="retail">ØªØ¬Ø²Ø¦Ø©</option><option value="corporate">Ø´Ø±ÙƒØ§Øª</option></select><select class="filter-select" id="engineerFilter"><option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†</option><!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --></select></div><div class="btn-group"><button type="button" class="btn btn-primary" onclick="addCustomer()"> â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ </button><button type="button" class="btn btn-success" onclick="exportCustomers()"> ğŸ“Š ØªØµØ¯ÙŠØ± </button><button type="button" class="btn btn-warning" onclick="importCustomers()"> ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ </button></div></div><div class="table-container"><table class="data-table" id="customersTable"><thead><tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ø´Ø±ÙƒØ©</th><th>Ø§Ù„ÙØ¦Ø©</th><th>Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</th><th>Ø­Ø¯ Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø¢Ø®Ø± ÙØ§ØªÙˆØ±Ø©</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody id="customersTableBody"><!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --></tbody></table></div><div class="pagination" id="pagination"><!-- Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --></div></div></div><!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ --><div id="customerModal" class="modal"><div class="modal-content"><div class="modal-header"><h3 id="customerModalTitle">Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3><button type="button" class="close-btn" onclick="closeModal('customerModal')">&times;</button></div><div class="modal-body"><div class="tabs"><div class="tab active" onclick="switchTab('basic')">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</div><div class="tab" onclick="switchTab('contact')">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</div><div class="tab" onclick="switchTab('financial')">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</div><div class="tab" onclick="switchTab('notes')">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div></div><form id="customerForm"><!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© --><div id="basic" class="tab-content active"><div class="form-grid"><div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ *</label><input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ" class="form-control" id="customerName" required aria-label="Ø­Ù‚Ù„ Ù†Øµ"></div><div class="form-group"><label class="form-label">ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„ *</label><input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ" class="form-control" id="customerCode" required aria-label="Ø­Ù‚Ù„ Ù†Øµ"></div><div class="form-group"><label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</label><input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ" class="form-control" id="companyName" aria-label="Ø­Ù‚Ù„ Ù†Øµ"></div><div class="form-group"><label class="form-label">ÙØ¦Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</label><select class="form-control" id="customerCategory"><option value="regular">Ø¹Ø§Ø¯ÙŠ</option><option value="vip">VIP</option><option value="wholesale">Ø¬Ù…Ù„Ø©</option><option value="retail">ØªØ¬Ø²Ø¦Ø©</option><option value="corporate">Ø´Ø±ÙƒØ§Øª</option></select></div><div class="form-group"><label class="form-label">Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</label><select class="form-control" id="salesEngineerId"><option value="">Ø§Ø®ØªØ± Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option><!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --></select></div><div class="form-group"><label class="form-label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</label><input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ" class="form-control" id="taxNumber" aria-label="Ø­Ù‚Ù„ Ù†Øµ"></div></div></div><!-- ØªØ¨ÙˆÙŠØ¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ --><div id="contact" class="tab-content"><div class="form-grid"><div class="form-group"><label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><input type="email" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="form-control" id="customerEmail" aria-label="Ø­Ù‚Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"></div><div class="form-group"><label class="form-label">Ø§Ù„Ù‡Ø§ØªÙ</label><input type="tel" class="form-control" id="customerPhone"></div><div class="form-group"><label class="form-label">Ø§Ù„Ø¬ÙˆØ§Ù„</label><input type="tel" class="form-control" id="customerMobile"></div><div class="form-group"><label class="form-label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ" class="form-control" id="customerCity" aria-label="Ø­Ù‚Ù„ Ù†Øµ"></div><div class="form-group"><label class="form-label">Ø§Ù„Ø¯ÙˆÙ„Ø©</label><input type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ" class="form-control" id="customerCountry" aria-label="Ø­Ù‚Ù„ Ù†Øµ"></div></div><div class="form-group"><label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><textarea class="form-control" id="customerAddress" rows="3"></textarea></div></div><!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© --><div id="financial" class="tab-content"><div class="form-grid"><div class="form-group"><label class="form-label">Ø­Ø¯ Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†</label><input type="number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…" class="form-control" id="creditLimit" min="0" step="0.01" aria-label="Ø­Ù‚Ù„ Ø±Ù‚Ù…"></div><div class="form-group"><label class="form-label">Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹ (Ø£ÙŠØ§Ù…)</label><input type="number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…" class="form-control" id="paymentTerms" min="0" value="30" aria-label="Ø­Ù‚Ù„ Ø±Ù‚Ù…"></div><div class="form-group"><label class="form-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (%)</label><input type="number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…" class="form-control" id="discountRate" min="0" max="100" step="0.1" aria-label="Ø­Ù‚Ù„ Ø±Ù‚Ù…"></div></div></div><!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª --><div id="notes" class="tab-content"><div class="form-group"><label class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea class="form-control" id="customerNotes" rows="5"></textarea></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-primary" onclick="saveCustomer()">ğŸ’¾ Ø­ÙØ¸</button><button type="button" class="btn" onclick="closeModal('customerModal')">Ø¥Ù„ØºØ§Ø¡</button></div></div></div><script src="js/navigation.js"></script><script> // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© let currentPage = 1; let totalPages = 1; let currentCustomerId = null; let customers = []; let salesEngineers = []; // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø© document.addEventListener('DOMContentLoaded', function() { loadCustomers(); loadStats(); loadSalesEngineers(); // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø« document.getElementById('searchInput').addEventListener('input', function() { currentPage = 1; loadCustomers(); }); // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙ„Ø§ØªØ± document.getElementById('categoryFilter').addEventListener('change', function() { currentPage = 1; loadCustomers(); }); document.getElementById('engineerFilter').addEventListener('change', function() { currentPage = 1; loadCustomers(); }); }); // ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ async function loadCustomers() { try { const search = document.getElementById('searchInput').value; const category = document.getElementById('categoryFilter').value; const salesEngineerId = document.getElementById('engineerFilter').value; const params = new URLSearchParams({ page: currentPage, per_page: 20, search: search, category: category, sales_engineer_id: salesEngineerId }); const response = await fetch(`/api/customers?${params}`); const data = await response.json(); if (data.success) { customers = data.data; displayCustomers(customers); updatePagination(data.pagination); } else { showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'); } } catch (error) { console.error('Error loading customers:', error); showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); } } // ØªØ­Ù…ÙŠÙ„ Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª async function loadSalesEngineers() { try { const response = await fetch('/api/sales-engineers?per_page=100'); const data = await response.json(); if (data.success) { salesEngineers = data.data; populateEngineersDropdown(); } } catch (error) { console.error('Error loading sales engineers:', error); } } // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª function populateEngineersDropdown() { const engineerFilter = document.getElementById('engineerFilter'); const salesEngineerSelect = document.getElementById('salesEngineerId'); // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… engineerFilter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†</option>'; salesEngineerSelect.innerHTML = '<option value="">Ø§Ø®ØªØ± Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>'; // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ† salesEngineers.forEach(engineer => { if (engineer.status === 'active') { const option1 = new Option(engineer.name, engineer.id); const option2 = new Option(engineer.name, engineer.id); engineerFilter.appendChild(option1); salesEngineerSelect.appendChild(option2); } }); } // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ function displayCustomers(customers) { const tbody = document.getElementById('customersTableBody'); if (customers.length === 0) { tbody.innerHTML = ` <tr><td colspan="9" class="empty-state"><div class="icon">ğŸ‘¥</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Ø¡</h3><p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</p></td></tr> `; return; } tbody.innerHTML = customers.map(customer => ` <tr><td><div class="customer-info"><div class="customer-avatar"> ${customer.name.charAt(0)} </div><div class="customer-details"><h4>${customer.name}</h4><p>${customer.email || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥ÙŠÙ…ÙŠÙ„'}</p></div></div></td><td>${customer.customer_code}</td><td>${customer.company_name || '-'}</td><td><span class="category-badge category-${customer.category}"> ${getCategoryText(customer.category)} </span></td><td>${customer.sales_engineer_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td><td>${formatCurrency(customer.credit_limit)}</td><td><div class="balance-indicator"><span class="balance-${customer.balance >= 0 ? 'positive' : 'negative'}"> ${formatCurrency(customer.balance)} </span></div></td><td>${customer.last_invoice_date ? formatDate(customer.last_invoice_date) : 'Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ±'}</td><td><div class="action-buttons"><button type="button" class="btn btn-primary btn-sm" onclick="viewCustomer(${customer.id})" title="Ø¹Ø±Ø¶"> ğŸ‘ï¸ </button><button type="button" class="btn btn-warning btn-sm" onclick="editCustomer(${customer.id})" title="ØªØ¹Ø¯ÙŠÙ„"> âœï¸ </button><button type="button" class="btn btn-success btn-sm" onclick="viewCustomerInvoices(${customer.id})" title="Ø§Ù„ÙÙˆØ§ØªÙŠØ±"> ğŸ§¾ </button><button type="button" class="btn btn-danger btn-sm" onclick="deleteCustomer(${customer.id})" title="Ø­Ø°Ù"> ğŸ—‘ï¸ </button></div></td></tr> `).join(''); } // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª async function loadStats() { try { const response = await fetch('/api/dashboard/stats'); const data = await response.json(); if (data.success) { document.getElementById('totalCustomers').textContent = data.data.total_customers || 0; document.getElementById('vipCustomers').textContent = Math.floor((data.data.total_customers || 0) * 0.1); // Ø§ÙØªØ±Ø§Ø¶ 10% VIP document.getElementById('activeCustomers').textContent = data.data.total_customers || 0; document.getElementById('totalDebt').textContent = formatCurrency(data.data.overdue_amount || 0); } } catch (error) { console.error('Error loading stats:', error); } } // Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ function addCustomer() { currentCustomerId = null; document.getElementById('customerModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯'; document.getElementById('customerForm').reset(); switchTab('basic'); openModal('customerModal'); } // ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù…ÙŠÙ„ function editCustomer(id) { const customer = customers.find(c => c.id === id); if (!customer) return; currentCustomerId = id; document.getElementById('customerModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„'; // Ù…Ù„Ø¡ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª document.getElementById('customerName').value = customer.name; document.getElementById('customerCode').value = customer.customer_code; document.getElementById('companyName').value = customer.company_name || ''; document.getElementById('customerCategory').value = customer.category; document.getElementById('salesEngineerId').value = customer.sales_engineer_id || ''; document.getElementById('taxNumber').value = customer.tax_number || ''; document.getElementById('customerEmail').value = customer.email || ''; document.getElementById('customerPhone').value = customer.phone || ''; document.getElementById('customerMobile').value = customer.mobile || ''; document.getElementById('customerCity').value = customer.city || ''; document.getElementById('customerCountry').value = customer.country || ''; document.getElementById('customerAddress').value = customer.address || ''; document.getElementById('creditLimit').value = customer.credit_limit; document.getElementById('paymentTerms').value = customer.payment_terms; document.getElementById('discountRate').value = customer.discount_rate; document.getElementById('customerNotes').value = customer.notes || ''; switchTab('basic'); openModal('customerModal'); } // Ø­ÙØ¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ async function saveCustomer() { try { const form = document.getElementById('customerForm'); if (!form.checkValidity()) { form.reportValidity(); return; } const formData = { name: document.getElementById('customerName').value, customer_code: document.getElementById('customerCode').value, company_name: document.getElementById('companyName').value, category: document.getElementById('customerCategory').value, sales_engineer_id: document.getElementById('salesEngineerId').value || null, tax_number: document.getElementById('taxNumber').value, email: document.getElementById('customerEmail').value, phone: document.getElementById('customerPhone').value, mobile: document.getElementById('customerMobile').value, city: document.getElementById('customerCity').value, country: document.getElementById('customerCountry').value, address: document.getElementById('customerAddress').value, credit_limit: parseFloat(document.getElementById('creditLimit').value) || 0, payment_terms: parseInt(document.getElementById('paymentTerms').value) || 30, discount_rate: parseFloat(document.getElementById('discountRate').value) || 0, notes: document.getElementById('customerNotes').value }; const url = currentCustomerId ? `/api/customers/${currentCustomerId}` : '/api/customers'; const method = currentCustomerId ? 'PUT' : 'POST'; const response = await fetch(url, { method: method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(formData) }); const data = await response.json(); if (data.success) { showSuccess(data.message); closeModal('customerModal'); loadCustomers(); loadStats(); } else { showError(data.message); } } catch (error) { console.error('Error saving customer:', error); showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); } } // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„ function viewCustomer(id) { const customer = customers.find(c => c.id === id); if (!customer) return; alert(`ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„:\n\nØ§Ù„Ø§Ø³Ù…: ${customer.name}\nÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${customer.customer_code}\nØ§Ù„Ø´Ø±ÙƒØ©: ${customer.company_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\nØ§Ù„ÙØ¦Ø©: ${getCategoryText(customer.category)}\nÙ…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: ${customer.sales_engineer_name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}\nØ­Ø¯ Ø§Ù„Ø§Ø¦ØªÙ…Ø§Ù†: ${formatCurrency(customer.credit_limit)}\nØ§Ù„Ø±ØµÙŠØ¯: ${formatCurrency(customer.balance)}\nØ´Ø±ÙˆØ· Ø§Ù„Ø¯ÙØ¹: ${customer.payment_terms} ÙŠÙˆÙ…`); } // Ø¹Ø±Ø¶ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø¹Ù…ÙŠÙ„ function viewCustomerInvoices(id) { // Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ø§Ù‹ alert('Ø³ÙŠØªÙ… ÙØªØ­ ØµÙØ­Ø© ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø¹Ù…ÙŠÙ„'); } // Ø­Ø°Ù Ø¹Ù…ÙŠÙ„ async function deleteCustomer(id) { if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„ØŸ\nØ³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡.')) { return; } try { const response = await fetch(`/api/customers/${id}`, { method: 'DELETE' }); const data = await response.json(); if (data.success) { showSuccess('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­'); loadCustomers(); loadStats(); } else { showError(data.message); } } catch (error) { console.error('Error deleting customer:', error); showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø¹Ù…ÙŠÙ„'); } } // ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª function exportCustomers() { // Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ø§Ù‹ alert('Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¥Ù„Ù‰ Excel'); } // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª function importCustomers() { // Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ø§Ù‹ alert('Ø³ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ù† Excel'); } // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª function switchTab(tabName) { // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª document.querySelectorAll('.tab-content').forEach(tab => { tab.classList.remove('active'); }); document.querySelectorAll('.tab').forEach(tab => { tab.classList.remove('active'); }); // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯ document.getElementById(tabName).classList.add('active'); event.target.classList.add('active'); } // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© function openModal(modalId) { document.getElementById(modalId).style.display = 'block'; } function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; } // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§ window.onclick = function(event) { if (event.target.classList.contains('modal')) { event.target.style.display = 'none'; } } // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª function updatePagination(pagination) { totalPages = pagination.pages; const paginationDiv = document.getElementById('pagination'); if (totalPages <= 1) { paginationDiv.innerHTML = ''; return; } let paginationHTML = ''; // Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ if (currentPage > 1) { paginationHTML += `<button onclick="changePage(${currentPage - 1})">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>`; } // Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª for (let i = 1; i <= totalPages; i++) { if (i === currentPage) { paginationHTML += `<button class="active">${i}</button>`; } else { paginationHTML += `<button onclick="changePage(${i})">${i}</button>`; } } // Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ if (currentPage < totalPages) { paginationHTML += `<button onclick="changePage(${currentPage + 1})">Ø§Ù„ØªØ§Ù„ÙŠ</button>`; } paginationDiv.innerHTML = paginationHTML; } // ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø© function changePage(page) { currentPage = page; loadCustomers(); } // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© function formatCurrency(amount) { return new Intl.NumberFormat('ar-SA', { style: 'currency', currency: 'SAR' }).format(amount || 0); } function formatDate(dateString) { return new Date(dateString).toLocaleDateString('ar-SA'); } function getCategoryText(category) { const categoryMap = { 'vip': 'VIP', 'regular': 'Ø¹Ø§Ø¯ÙŠ', 'wholesale': 'Ø¬Ù…Ù„Ø©', 'retail': 'ØªØ¬Ø²Ø¦Ø©', 'corporate': 'Ø´Ø±ÙƒØ§Øª' }; return categoryMap[category] || category; } function showSuccess(message) { alert('âœ… ' + message); } function showError(message) { alert('âŒ ' + message); } </script></body></html> 