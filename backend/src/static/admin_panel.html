<!-- ملف: /home/ubuntu/complete_inventory_system/backend/src/static/admin_panel.html --><!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>لوحة الإدارة المتقدمة - نظام إدارة المخزون</title><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"><style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; direction: rtl; } .admin-container { max-width: 1400px; margin: 0 auto; padding: 20px; } .header { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); text-align: center; } .header h1 { color: #2d3748; font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; } .header p { color: #718096; font-size: 1.1rem; } .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-bottom: 30px; } .admin-card { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 20px; padding: 30px; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; border: 1px solid rgba(255, 255, 255, 0.2); } .admin-card:hover { transform: translateY(-10px); box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15); } .card-header { display: flex; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0; } .card-icon { width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; margin-left: 15px; font-size: 1.5rem; color: white; } .users-icon { background: linear-gradient(135deg, #667eea, #764ba2); } .security-icon { background: linear-gradient(135deg, #f093fb, #f5576c); } .import-icon { background: linear-gradient(135deg, #4facfe, #00f2fe); } .backup-icon { background: linear-gradient(135deg, #43e97b, #38f9d7); } .card-title { color: #2d3748; font-size: 1.4rem; font-weight: 600; } .card-description { color: #718096; margin-bottom: 25px; line-height: 1.6; } .action-buttons { display: flex; flex-direction: column; gap: 12px; } .btn { padding: 12px 20px; border: none; border-radius: 12px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-decoration: none; text-align: center; display: flex; align-items: center; justify-content: center; gap: 8px; } .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; } .btn-secondary { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; } .btn-success { background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; } .btn-warning { background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #8b4513; } .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); } .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; } .stat-card { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; text-align: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; } .stat-card:hover { transform: translateY(-5px); } .stat-number { font-size: 2.5rem; font-weight: 700; color: #667eea; margin-bottom: 10px; } .stat-label { color: #718096; font-size: 0.9rem; font-weight: 500; } .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); z-index: 1000; align-items: center; justify-content: center; } .modal-content { background: white; border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3); } .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 2px solid #e2e8f0; } .modal-title { font-size: 1.5rem; font-weight: 600; color: #2d3748; } .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #718096; padding: 5px; border-radius: 50%; transition: all 0.3s ease; } .close-btn:hover { background: #f7fafc; color: #2d3748; } .form-group { margin-bottom: 20px; } .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #2d3748; } .form-input { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; transition: all 0.3s ease; } .form-input:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); } .form-select { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; background: white; cursor: pointer; } .alert { padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; font-weight: 500; } .alert-success { background: #f0fff4; color: #22543d; border: 1px solid #9ae6b4; } .alert-error { background: #fed7d7; color: #742a2a; border: 1px solid #feb2b2; } .loading { display: none; text-align: center; padding: 20px; } .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 15px; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .file-upload { border: 2px dashed #cbd5e0; border-radius: 10px; padding: 30px; text-align: center; transition: all 0.3s ease; cursor: pointer; } .file-upload:hover { border-color: #667eea; background: #f7fafc; } .file-upload.dragover { border-color: #667eea; background: #ebf8ff; } .file-upload-icon { font-size: 3rem; color: #cbd5e0; margin-bottom: 15px; } .file-input-hidden { display: none; } @media (max-width: 768px) { .admin-grid { grid-template-columns: 1fr; } .stats-grid { grid-template-columns: repeat(2, 1fr); } .header h1 { font-size: 2rem; } .modal-content { padding: 20px; margin: 20px; } } </style></head><body><div class="admin-container"><!-- Header --><div class="header"><h1><i class="fas fa-crown"></i> لوحة الإدارة المتقدمة</h1><p>إدارة شاملة للنظام والمستخدمين والأمان</p></div><!-- Statistics --><div class="stats-grid"><div class="stat-card"><div class="stat-number" id="totalUsers">0</div><div class="stat-label">إجمالي المستخدمين</div></div><div class="stat-card"><div class="stat-number" id="lockedUsers">0</div><div class="stat-label">المستخدمين المقفلين</div></div><div class="stat-card"><div class="stat-number" id="securityEvents">0</div><div class="stat-label">أحداث الأمان اليوم</div></div><div class="stat-card"><div class="stat-number" id="loginAttempts">0</div><div class="stat-label">محاولات الدخول اليوم</div></div></div><!-- Admin Cards --><div class="admin-grid"><!-- User Management --><div class="admin-card"><div class="card-header"><div class="card-icon users-icon"><i class="fas fa-users"></i></div><div class="card-title">إدارة المستخدمين</div></div><div class="card-description"> إدارة شاملة للمستخدمين، الصلاحيات، كلمات المرور، وحالات القفل </div><div class="action-buttons"><button type="button" class="btn btn-primary" onclick="openUserManagement()" title="إدارة المستخدمين"><i class="fas fa-user-cog"></i> إدارة المستخدمين </button><button type="button" class="btn btn-secondary" onclick="openAddUser()" title="إضافة مستخدم جديد"><i class="fas fa-user-plus"></i> إضافة مستخدم جديد </button><button type="button" class="btn btn-warning" onclick="openLockedUsers()" title="عرض المستخدمين المقفلين"><i class="fas fa-lock"></i> المستخدمين المقفلين </button></div></div><!-- Security Management --><div class="admin-card"><div class="card-header"><div class="card-icon security-icon"><i class="fas fa-shield-alt"></i></div><div class="card-title">إدارة الأمان</div></div><div class="card-description"> مراقبة أحداث الأمان، محاولات تسجيل الدخول، وإعدادات الحماية </div><div class="action-buttons"><button type="button" class="btn btn-primary" onclick="openSecurityEvents()" title="عرض أحداث الأمان"><i class="fas fa-history"></i> أحداث الأمان </button><button type="button" class="btn btn-secondary" onclick="openLoginAttempts()" title="عرض محاولات الدخول"><i class="fas fa-sign-in-alt"></i> محاولات الدخول </button><button type="button" class="btn btn-warning" onclick="openSecuritySettings()" title="إعدادات الأمان"><i class="fas fa-cog"></i> إعدادات الأمان </button></div></div><!-- Data Import --><div class="admin-card"><div class="card-header"><div class="card-icon import-icon"><i class="fas fa-file-import"></i></div><div class="card-title">استيراد البيانات</div></div><div class="card-description"> استيراد البيانات من ملفات Excel للعملاء، الموردين، والأصناف </div><div class="action-buttons"><button type="button" class="btn btn-primary" onclick="openDataImport()" title="استيراد البيانات"><i class="fas fa-upload"></i> استيراد البيانات </button><button type="button" class="btn btn-success" onclick="downloadTemplates()" title="تحميل قوالب Excel"><i class="fas fa-download"></i> تحميل القوالب </button><button type="button" class="btn btn-warning" onclick="openImportHistory()" title="عرض تاريخ الاستيراد"><i class="fas fa-history"></i> تاريخ الاستيراد </button></div></div><!-- Database Management --><div class="admin-card"><div class="card-header"><div class="card-icon backup-icon"><i class="fas fa-database"></i></div><div class="card-title">إدارة قاعدة البيانات</div></div><div class="card-description"> النسخ الاحتياطي، الاستعادة، وإدارة قاعدة البيانات </div><div class="action-buttons"><button type="button" class="btn btn-primary" onclick="createBackup()" title="إنشاء نسخة احتياطية"><i class="fas fa-save"></i> إنشاء نسخة احتياطية </button><button type="button" class="btn btn-secondary" onclick="openRestoreDatabase()" title="استعادة قاعدة البيانات"><i class="fas fa-undo"></i> استعادة قاعدة البيانات </button><button type="button" class="btn btn-success" onclick="exportDatabase()" title="تصدير البيانات"><i class="fas fa-file-export"></i> تصدير البيانات </button></div></div></div></div><!-- User Management Modal --><div id="userManagementModal" class="modal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">إدارة المستخدمين</h2><button type="button" class="close-btn" onclick="closeModal('userManagementModal')">&times;</button></div><div id="usersList"></div></div></div><!-- Add User Modal --><div id="addUserModal" class="modal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">إضافة مستخدم جديد</h2><button type="button" class="close-btn" onclick="closeModal('addUserModal')">&times;</button></div><form id="addUserForm"><div class="form-group"><label for="username" class="form-label">اسم المستخدم</label><input type="text" placeholder="أدخل النص" class="form-input" id="username" name="username" required aria-label="اسم المستخدم" ></div><div class="form-group"><label for="full_name" class="form-label">الاسم الكامل</label><input type="text" placeholder="أدخل النص" class="form-input" id="full_name" name="full_name" required aria-label="الاسم الكامل" ></div><div class="form-group"><label for="email" class="form-label">البريد الإلكتروني</label><input type="email" placeholder="أدخل البريد الإلكتروني" class="form-input" id="email" name="email" required aria-label="البريد الإلكتروني" ></div><div class="form-group"><label for="password" class="form-label">كلمة المرور</label><input type="password" class="form-input" id="password" name="password" required aria-label="كلمة المرور"></div><div class="form-group"><label for="role" class="form-label">الدور</label><select class="form-select" aria-label="اختيار من القائمة" title="اختيار من القائمة" id="role" name="role" required ><option value="">اختر الدور</option><option value="admin">مدير</option><option value="manager">مدير قسم</option><option value="employee">موظف</option><option value="viewer">مشاهد</option></select></div><div class="action-buttons"><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> إضافة المستخدم </button></div></form></div></div><!-- Data Import Modal --><div id="dataImportModal" class="modal"><div class="modal-content"><div class="modal-header"><h2 class="modal-title">استيراد البيانات</h2><button type="button" class="close-btn" onclick="closeModal('dataImportModal')">&times;</button></div><div class="form-group"><label for="importType" class="form-label">نوع البيانات</label><select class="form-select" aria-label="اختيار من القائمة" title="اختيار من القائمة" id="importType" ><option value="">اختر نوع البيانات</option><option value="customers">العملاء</option><option value="suppliers">الموردين</option><option value="products">الأصناف</option><option value="warehouses">المخازن</option></select></div><div class="file-upload" id="fileUpload"><i class="fas fa-cloud-upload-alt file-upload-icon"></i><p>اسحب وأفلت ملف Excel هنا أو انقر للاختيار</p><input type="file" id="fileInput" accept=".xlsx,.xls" class="file-input-hidden"></div><div id="importProgress" class="loading"><div class="spinner"></div><p>جاري استيراد البيانات...</p></div><div id="importResult"></div></div></div><script> // Global variables let currentUser = null; // Initialize page document.addEventListener('DOMContentLoaded', function() { loadStatistics(); setupFileUpload(); }); // Load statistics async function loadStatistics() { try { // Load user statistics const usersResponse = await fetch('/api/admin/users/stats'); if (usersResponse.ok) { const usersData = await usersResponse.json(); document.getElementById('totalUsers').textContent = usersData.total || 0; document.getElementById('lockedUsers').textContent = usersData.locked || 0; } // Load security statistics const securityResponse = await fetch('/api/admin/security/stats'); if (securityResponse.ok) { const securityData = await securityResponse.json(); document.getElementById('securityEvents').textContent = securityData.events_today || 0; document.getElementById('loginAttempts').textContent = securityData.login_attempts_today || 0; } } catch (error) { console.error('Error loading statistics:', error); } } // Modal functions function openModal(modalId) { document.getElementById(modalId).style.display = 'flex'; } function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; } // User management functions function openUserManagement() { openModal('userManagementModal'); loadUsers(); } function openAddUser() { openModal('addUserModal'); } async function loadUsers() { try { const response = await fetch('/api/admin/users'); if (response.ok) { const users = await response.json(); displayUsers(users); } } catch (error) { console.error('Error loading users:', error); } } function displayUsers(users) { const usersList = document.getElementById('usersList'); usersList.innerHTML = users.map(user => ` <div class="user-item" style="border: 1px solid #e2e8f0; border-radius: 10px; padding: 20px; margin-bottom: 15px;"><div style="display: flex; justify-content: space-between; align-items: center;"><div><h4>${user.full_name}</h4><p style="color: #718096;">@${user.username} - ${user.role}</p><p style="color: #718096; font-size: 0.9rem;">${user.email}</p></div><div style="display: flex; gap: 10px;"><button type="button" class="btn btn-secondary" onclick="resetUserPassword(${user.id})" style="padding: 8px 12px; font-size: 0.8rem;"><i class="fas fa-key"></i> إعادة تعيين كلمة المرور </button> ${user.is_locked ? `<button type="button" class="btn btn-success" onclick="unlockUser(${user.id})" style="padding: 8px 12px; font-size: 0.8rem;"><i class="fas fa-unlock"></i> إلغاء القفل </button>` : `<button type="button" class="btn btn-warning" onclick="lockUser(${user.id})" style="padding: 8px 12px; font-size: 0.8rem;"><i class="fas fa-lock"></i> قفل المستخدم </button>` } </div></div></div> `).join(''); } // Add user form submission document.getElementById('addUserForm').addEventListener('submit', async function(e) { e.preventDefault(); const formData = new FormData(e.target); const userData = Object.fromEntries(formData); try { const response = await fetch('/api/admin/users', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(userData) }); if (response.ok) { showAlert('تم إضافة المستخدم بنجاح', 'success'); closeModal('addUserModal'); e.target.reset(); loadStatistics(); } else { const error = await response.json(); showAlert(error.error || 'خطأ في إضافة المستخدم', 'error'); } } catch (error) { showAlert('خطأ في الاتصال بالخادم', 'error'); } }); // User actions async function resetUserPassword(userId) { const newPassword = prompt('أدخل كلمة المرور الجديدة:'); if (!newPassword) return; try { const response = await fetch('/api/security/admin/reset-password', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ user_id: userId, new_password: newPassword }) }); if (response.ok) { showAlert('تم إعادة تعيين كلمة المرور بنجاح', 'success'); } else { const error = await response.json(); showAlert(error.error || 'خطأ في إعادة تعيين كلمة المرور', 'error'); } } catch (error) { showAlert('خطأ في الاتصال بالخادم', 'error'); } } async function unlockUser(userId) { try { const response = await fetch('/api/security/admin/unlock-user', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ user_id: userId }) }); if (response.ok) { showAlert('تم إلغاء قفل المستخدم بنجاح', 'success'); loadUsers(); loadStatistics(); } else { const error = await response.json(); showAlert(error.error || 'خطأ في إلغاء قفل المستخدم', 'error'); } } catch (error) { showAlert('خطأ في الاتصال بالخادم', 'error'); } } // Data import functions function openDataImport() { openModal('dataImportModal'); } function setupFileUpload() { const fileUpload = document.getElementById('fileUpload'); const fileInput = document.getElementById('fileInput'); fileUpload.addEventListener('click', () => fileInput.click()); fileUpload.addEventListener('dragover', (e) => { e.preventDefault(); fileUpload.classList.add('dragover'); }); fileUpload.addEventListener('dragleave', () => { fileUpload.classList.remove('dragover'); }); fileUpload.addEventListener('drop', (e) => { e.preventDefault(); fileUpload.classList.remove('dragover'); const files = e.dataTransfer.files; if (files.length > 0) { handleFileUpload(files[0]); } }); fileInput.addEventListener('change', (e) => { if (e.target.files.length > 0) { handleFileUpload(e.target.files[0]); } }); } async function handleFileUpload(file) { const importType = document.getElementById('importType').value; if (!importType) { showAlert('يرجى اختيار نوع البيانات أولاً', 'error'); return; } // const formData = new FormData(); formData.append('file', file); document.getElementById('importProgress').style.display = 'block'; try { const response = await fetch(`/api/excel/import/${importType}`, { method: 'POST', body: formData }); const result = await response.json(); document.getElementById('importProgress').style.display = 'none'; if (response.ok) { displayImportResult(result); } else { showAlert(result.error || 'خطأ في استيراد البيانات', 'error'); } } catch (error) { document.getElementById('importProgress').style.display = 'none'; showAlert('خطأ في الاتصال بالخادم', 'error'); } } function displayImportResult(result) { const resultDiv = document.getElementById('importResult'); resultDiv.innerHTML = ` <div class="alert alert-success"><h4>نتائج الاستيراد</h4><p>إجمالي السجلات: ${result.total_count}</p><p>السجلات المستوردة بنجاح: ${result.success_count}</p><p>الأخطاء: ${result.error_count}</p><p>التحذيرات: ${result.warning_count}</p> ${result.errors && result.errors.length > 0 ? `<details><summary>تفاصيل الأخطاء</summary><ul>${result.errors.map(error => `<li>${error}</li>`).join('')}</ul></details>` : '' } </div> `; } // Template download functions async function downloadTemplates() { try { const response = await fetch('/api/excel/templates/all'); if (response.ok) { const blob = await response.blob(); const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'قوالب_الاستيراد_الشاملة.xlsx'; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url); document.body.removeChild(a); showAlert('تم تحميل القوالب بنجاح', 'success'); } else { showAlert('خطأ في تحميل القوالب', 'error'); } } catch (error) { showAlert('خطأ في الاتصال بالخادم', 'error'); } } // Database functions async function createBackup() { try { const response = await fetch('/api/admin/backup', { method: 'POST' }); if (response.ok) { const blob = await response.blob(); const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `backup_${new Date().toISOString().split('T')[0]}.sql`; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url); document.body.removeChild(a); showAlert('تم إنشاء النسخة الاحتياطية بنجاح', 'success'); } else { showAlert('خطأ في إنشاء النسخة الاحتياطية', 'error'); } } catch (error) { showAlert('خطأ في الاتصال بالخادم', 'error'); } } // Utility functions function showAlert(message, type) { const alertDiv = document.createElement('div'); alertDiv.className = `alert alert-${type}`; alertDiv.textContent = message; document.body.appendChild(alertDiv); setTimeout(() => { document.body.removeChild(alertDiv); }, 5000); } // Placeholder functions for other features function openLockedUsers() { showAlert('ميزة المستخدمين المقفلين قيد التطوير', 'warning'); } function openSecurityEvents() { showAlert('ميزة أحداث الأمان قيد التطوير', 'warning'); } function openLoginAttempts() { showAlert('ميزة محاولات الدخول قيد التطوير', 'warning'); } function openSecuritySettings() { showAlert('ميزة إعدادات الأمان قيد التطوير', 'warning'); } function openImportHistory() { showAlert('ميزة تاريخ الاستيراد قيد التطوير', 'warning'); } function openRestoreDatabase() { showAlert('ميزة استعادة قاعدة البيانات قيد التطوير', 'warning'); } function exportDatabase() { showAlert('ميزة تصدير البيانات قيد التطوير', 'warning'); } function lockUser(userId) { showAlert('ميزة قفل المستخدم قيد التطوير', 'warning'); } </script></body></html> 