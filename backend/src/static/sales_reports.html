<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª - Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title><link rel="stylesheet" href="css/style.css"><link rel="stylesheet" href="css/navigation.css"><style> .reports-container { max-width: 1400px; margin: 20px auto; padding: 0 20px; } .page-header { background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; text-align: center; } .reports-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-bottom: 30px; } .report-card { background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); overflow: hidden; transition: transform 0.3s ease; } .report-card:hover { transform: translateY(-5px); } .report-header { padding: 25px; background: linear-gradient(135deg, #f8f9fa, #e9ecef); border-bottom: 1px solid #dee2e6; } .report-title { font-size: 1.3em; font-weight: bold; color: #2c3e50; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; } .report-description { color: #7f8c8d; font-size: 0.95em; } .report-body { padding: 25px; } .filter-group { margin-bottom: 20px; } .filter-label { display: block; margin-bottom: 8px; font-weight: 500; color: #2c3e50; } .filter-control { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; transition: border-color 0.3s ease; } .filter-control:focus { outline: none; border-color: #8e44ad; } .date-range { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; } .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 1em; font-weight: 500; transition: all 0.3s ease; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 8px; width: 100%; margin-top: 15px; } .btn-primary { background: #8e44ad; color: white; } .btn-primary:hover { background: #7d3c98; transform: translateY(-2px); } .btn-success { background: #27ae60; color: white; } .btn-warning { background: #f39c12; color: white; } .btn-danger { background: #e74c3c; color: white; } .btn-info { background: #3498db; color: white; } .main-content { background: white; border-radius: 15px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); overflow: hidden; margin-top: 30px; } .content-header { background: #f8f9fa; padding: 25px 30px; border-bottom: 1px solid #dee2e6; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; } .tabs { display: flex; border-bottom: 2px solid #e0e0e0; margin-bottom: 25px; } .tab { padding: 15px 25px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s ease; font-weight: 500; display: flex; align-items: center; gap: 8px; } .tab.active { border-bottom-color: #8e44ad; color: #8e44ad; background: #f8f9fa; } .tab-content { display: none; padding: 25px; } .tab-content.active { display: block; } .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; } .data-table th { background: #f8f9fa; padding: 15px; text-align: right; font-weight: 600; border-bottom: 2px solid #dee2e6; } .data-table td { padding: 15px; border-bottom: 1px solid #f0f0f0; vertical-align: middle; } .data-table tr:hover { background: #f8f9fa; } .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; } .summary-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); text-align: center; border-top: 4px solid; } .summary-card.total { border-top-color: #3498db; } .summary-card.paid { border-top-color: #27ae60; } .summary-card.pending { border-top-color: #f39c12; } .summary-card.overdue { border-top-color: #e74c3c; } .summary-number { font-size: 2em; font-weight: bold; margin-bottom: 10px; } .summary-label { color: #7f8c8d; font-size: 0.9em; } .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.9em; font-weight: 500; } .status-paid { background: #d4edda; color: #155724; } .status-pending { background: #fff3cd; color: #856404; } .status-overdue { background: #f8d7da; color: #721c24; } .status-partial { background: #d1ecf1; color: #0c5460; } .chart-container { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); margin-bottom: 25px; } .chart-title { font-size: 1.2em; font-weight: bold; margin-bottom: 20px; color: #2c3e50; } .progress-bar { width: 100%; height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; margin: 10px 0; } .progress-fill { height: 100%; background: linear-gradient(90deg, #27ae60, #2ecc71); transition: width 0.3s ease; } .debt-indicator { display: flex; align-items: center; gap: 10px; } .debt-level { padding: 3px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 500; } .debt-low { background: #d4edda; color: #155724; } .debt-medium { background: #fff3cd; color: #856404; } .debt-high { background: #f8d7da; color: #721c24; } .empty-state { text-align: center; padding: 60px 20px; color: #7f8c8d; } .empty-state .icon { font-size: 4em; margin-bottom: 20px; } .loading { text-align: center; padding: 40px; color: #7f8c8d; } .loading .spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #8e44ad; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } @media (max-width: 768px) { .reports-grid { grid-template-columns: 1fr; } .content-header { flex-direction: column; align-items: stretch; } .tabs { flex-wrap: wrap; } .tab { flex: 1; min-width: 120px; } .summary-cards { grid-template-columns: repeat(2, 1fr); } .date-range { grid-template-columns: 1fr; } } </style></head><body><div class="reports-container"><div class="page-header"><h1>ğŸ“Š ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</h1><p>ØªÙ‚Ø§Ø±ÙŠØ± Ø´Ø§Ù…Ù„Ø© ÙˆÙ…ÙØµÙ„Ø© Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</p></div><!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø³Ø±ÙŠØ¹Ø© --><div class="reports-grid"><!-- ØªÙ‚Ø±ÙŠØ± Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª --><div class="report-card"><div class="report-header"><div class="report-title"> ğŸ‘¨â€ğŸ’¼ ØªÙ‚Ø±ÙŠØ± Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª </div><div class="report-description"> Ø£Ø¯Ø§Ø¡ Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ø£Ù‡Ø¯Ø§Ù </div></div><div class="report-body"><div class="filter-group"><label class="filter-label">Ù…Ù‡Ù†Ø¯Ø³ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</label><select class="filter-control" id="engineerSelect"><option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†</option></select></div><div class="filter-group"><label class="filter-label">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</label><div class="date-range"><input type="date" class="filter-control" id="engineerDateFrom"><input type="date" class="filter-control" id="engineerDateTo"></div></div><button type="button" class="btn btn-primary" onclick="generateEngineersReport()"> ğŸ“ˆ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± </button></div></div><!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ --><div class="report-card"><div class="report-header"><div class="report-title"> ğŸ‘¥ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ </div><div class="report-description"> ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØ§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª ÙˆØ§Ù„Ø£Ø±ØµØ¯Ø© </div></div><div class="report-body"><div class="filter-group"><label class="filter-label">Ø§Ù„Ø¹Ù…ÙŠÙ„</label><select class="filter-control" id="customerSelect"><option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option></select></div><div class="filter-group"><label class="filter-label">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</label><div class="date-range"><input type="date" class="filter-control" id="customerDateFrom"><input type="date" class="filter-control" id="customerDateTo"></div></div><button type="button" class="btn btn-success" onclick="generateCustomersReport()"> ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± </button></div></div><!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª --><div class="report-card"><div class="report-header"><div class="report-title"> ğŸ’° ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª </div><div class="report-description"> Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø© ÙˆØ£Ø¹Ù…Ø§Ø± Ø§Ù„Ø¯ÙŠÙˆÙ† </div></div><div class="report-body"><div class="filter-group"><label class="filter-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</label><select class="filter-control" id="debtType"><option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</option><option value="current">Ø¬Ø§Ø±ÙŠØ©</option><option value="overdue">Ù…ØªØ£Ø®Ø±Ø©</option><option value="critical">Ø­Ø±Ø¬Ø©</option></select></div><div class="filter-group"><label class="filter-label">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø¨Ù„Øº</label><input type="number" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù…" class="filter-control" id="minAmount" min="0" step="0.01" aria-label="Ø­Ù‚Ù„ Ø±Ù‚Ù…"></div><button type="button" class="btn btn-danger" onclick="generateDebtsReport()"> ğŸ” Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± </button></div></div><!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª --><div class="report-card"><div class="report-header"><div class="report-title"> ğŸ’³ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª </div><div class="report-description"> Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆÙ…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª </div></div><div class="report-body"><div class="filter-group"><label class="filter-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</label><select class="filter-control" id="paymentType"><option value="customer">Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option><option value="engineer">Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†</option></select></div><div class="filter-group"><label class="filter-label">Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</label><div class="date-range"><input type="date" class="filter-control" id="paymentDateFrom"><input type="date" class="filter-control" id="paymentDateTo"></div></div><button type="button" class="btn btn-info" onclick="generatePaymentsReport()"> ğŸ’° Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± </button></div></div></div><!-- Ù…Ù†Ø·Ù‚Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± --><div class="main-content" id="reportsContent" style="display: none;"><div class="content-header"><h3 id="reportTitle">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3><div class="btn-group"><button type="button" class="btn btn-success" onclick="exportReport()"> ğŸ“Š ØªØµØ¯ÙŠØ± Excel </button><button type="button" class="btn btn-warning" onclick="printReport()"> ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© </button></div></div><div class="tabs"><div class="tab active" onclick="switchReportTab('summary')"> ğŸ“ˆ Ø§Ù„Ù…Ù„Ø®Øµ </div><div class="tab" onclick="switchReportTab('details')"> ğŸ“‹ Ø§Ù„ØªÙØ§ØµÙŠÙ„ </div><div class="tab" onclick="switchReportTab('charts')"> ğŸ“Š Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© </div></div><!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ù„Ø®Øµ --><div id="summary" class="tab-content active"><div class="summary-cards" id="summaryCards"><!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --></div><div id="summaryContent"><!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ø®Øµ --></div></div><!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙØ§ØµÙŠÙ„ --><div id="details" class="tab-content"><div class="table-container"><table class="data-table" id="detailsTable"><thead id="detailsTableHead"><!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --></thead><tbody id="detailsTableBody"><!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ --></tbody></table></div></div><!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© --><div id="charts" class="tab-content"><div class="chart-container"><div class="chart-title">Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©</div><div id="chartsContent"><!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ù‡Ù†Ø§ --></div></div></div></div></div><script src="js/navigation.js"></script><script> // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© let currentReportType = ''; let currentReportData = null; let salesEngineers = []; let customers = []; // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØµÙØ­Ø© document.addEventListener('DOMContentLoaded', function() { loadSalesEngineers(); loadCustomers(); setDefaultDates(); }); // ØªØ­Ù…ÙŠÙ„ Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª async function loadSalesEngineers() { try { const response = await fetch('/api/sales-engineers?per_page=100'); const data = await response.json(); if (data.success) { salesEngineers = data.data; populateEngineersDropdown(); } } catch (error) { console.error('Error loading sales engineers:', error); } } // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ async function loadCustomers() { try { const response = await fetch('/api/customers?per_page=100'); const data = await response.json(); if (data.success) { customers = data.data; populateCustomersDropdown(); } } catch (error) { console.error('Error loading customers:', error); } } // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª function populateEngineersDropdown() { const engineerSelect = document.getElementById('engineerSelect'); engineerSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†</option>'; salesEngineers.forEach(engineer => { if (engineer.status === 'active') { const option = new Option(engineer.name, engineer.id); engineerSelect.appendChild(option); } }); } // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ function populateCustomersDropdown() { const customerSelect = document.getElementById('customerSelect'); customerSelect.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</option>'; customers.forEach(customer => { const option = new Option(customer.name, customer.id); customerSelect.appendChild(option); }); } // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© function setDefaultDates() { const today = new Date(); const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1); const todayStr = today.toISOString().split('T')[0]; const firstDayStr = firstDayOfMonth.toISOString().split('T')[0]; // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ± document.getElementById('engineerDateFrom').value = firstDayStr; document.getElementById('engineerDateTo').value = todayStr; document.getElementById('customerDateFrom').value = firstDayStr; document.getElementById('customerDateTo').value = todayStr; document.getElementById('paymentDateFrom').value = firstDayStr; document.getElementById('paymentDateTo').value = todayStr; } // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª async function generateEngineersReport() { try { showLoading(); currentReportType = 'engineers'; const engineerId = document.getElementById('engineerSelect').value; const dateFrom = document.getElementById('engineerDateFrom').value; const dateTo = document.getElementById('engineerDateTo').value; const params = new URLSearchParams({ engineer_id: engineerId, period_from: dateFrom, period_to: dateTo }); const response = await fetch(`/api/reports/sales-engineers?${params}`); const data = await response.json(); if (data.success) { currentReportData = data.data; displayEngineersReport(data.data); document.getElementById('reportTitle').textContent = 'ØªÙ‚Ø±ÙŠØ± Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'; showReportsContent(); } else { showError('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'); } } catch (error) { console.error('Error generating engineers report:', error); showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'); } } // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ async function generateCustomersReport() { try { showLoading(); currentReportType = 'customers'; const customerId = document.getElementById('customerSelect').value; const dateFrom = document.getElementById('customerDateFrom').value; const dateTo = document.getElementById('customerDateTo').value; const params = new URLSearchParams({ customer_id: customerId, period_from: dateFrom, period_to: dateTo }); const response = await fetch(`/api/reports/customers?${params}`); const data = await response.json(); if (data.success) { currentReportData = data.data; displayCustomersReport(data.data); document.getElementById('reportTitle').textContent = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'; showReportsContent(); } else { showError('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'); } } catch (error) { console.error('Error generating customers report:', error); showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'); } } // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª async function generateDebtsReport() { try { showLoading(); currentReportType = 'debts'; const response = await fetch('/api/reports/debts'); const data = await response.json(); if (data.success) { currentReportData = data.data; displayDebtsReport(data.data); document.getElementById('reportTitle').textContent = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª'; showReportsContent(); } else { showError('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'); } } catch (error) { console.error('Error generating debts report:', error); showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'); } } // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª async function generatePaymentsReport() { try { showLoading(); currentReportType = 'payments'; const paymentType = document.getElementById('paymentType').value; const dateFrom = document.getElementById('paymentDateFrom').value; const dateTo = document.getElementById('paymentDateTo').value; const params = new URLSearchParams({ type: paymentType, date_from: dateFrom, date_to: dateTo }); const response = await fetch(`/api/customer-payments?${params}`); const data = await response.json(); if (data.success) { currentReportData = data.data; displayPaymentsReport(data.data); document.getElementById('reportTitle').textContent = 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª'; showReportsContent(); } else { showError('ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'); } } catch (error) { console.error('Error generating payments report:', error); showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±'); } } // Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ù…Ù‡Ù†Ø¯Ø³ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª function displayEngineersReport(data) { // Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù„Ø®Øµ const summaryCards = document.getElementById('summaryCards'); summaryCards.innerHTML = ` <div class="summary-card total"><div class="summary-number">${data.length}</div><div class="summary-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†</div></div><div class="summary-card paid"><div class="summary-number">${formatCurrency(data.reduce((sum, eng) => sum + (eng.total_sales || 0), 0))}</div><div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</div></div><div class="summary-card pending"><div class="summary-number">${formatCurrency(data.reduce((sum, eng) => sum + (eng.total_commission || 0), 0))}</div><div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø§Øª</div></div><div class="summary-card overdue"><div class="summary-number">${Math.round(data.reduce((sum, eng) => sum + (eng.achievement_rate || 0), 0) / data.length)}%</div><div class="summary-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</div></div> `; // Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ const tableHead = document.getElementById('detailsTableHead'); const tableBody = document.getElementById('detailsTableBody'); tableHead.innerHTML = ` <tr><th>Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</th><th>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</th><th>Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©</th><th>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø´Ù‡Ø±ÙŠ</th><th>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</th></tr> `; if (data.length === 0) { tableBody.innerHTML = ` <tr><td colspan="7" class="empty-state"><div class="icon">ğŸ“Š</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</h3><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p></td></tr> `; return; } tableBody.innerHTML = data.map(engineer => ` <tr><td>${engineer.name}</td><td>${engineer.customers_count || 0}</td><td>${engineer.invoices_count || 0}</td><td>${formatCurrency(engineer.total_sales || 0)}</td><td>${formatCurrency(engineer.total_commission || 0)}</td><td>${formatCurrency(engineer.target_monthly || 0)}</td><td><div class="progress-bar"><div class="progress-fill" style="width: ${Math.min(100, engineer.achievement_rate || 0)}%"></div></div> ${Math.round(engineer.achievement_rate || 0)}% </td></tr> `).join(''); } // Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ function displayCustomersReport(data) { // Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù„Ø®Øµ const summaryCards = document.getElementById('summaryCards'); summaryCards.innerHTML = ` <div class="summary-card total"><div class="summary-number">${data.length}</div><div class="summary-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div></div><div class="summary-card paid"><div class="summary-number">${formatCurrency(data.reduce((sum, cust) => sum + (cust.total_invoices_amount || 0), 0))}</div><div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</div></div><div class="summary-card pending"><div class="summary-number">${formatCurrency(data.reduce((sum, cust) => sum + (cust.total_payments || 0), 0))}</div><div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div></div><div class="summary-card overdue"><div class="summary-number">${formatCurrency(data.reduce((sum, cust) => sum + (cust.balance || 0), 0))}</div><div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±ØµØ¯Ø©</div></div> `; // Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ const tableHead = document.getElementById('detailsTableHead'); const tableBody = document.getElementById('detailsTableBody'); tableHead.innerHTML = ` <tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th><th>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</th><th>Ø§Ù„Ø±ØµÙŠØ¯</th><th>Ø¢Ø®Ø± ÙØ§ØªÙˆØ±Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr> `; if (data.length === 0) { tableBody.innerHTML = ` <tr><td colspan="7" class="empty-state"><div class="icon">ğŸ‘¥</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</h3><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p></td></tr> `; return; } tableBody.innerHTML = data.map(customer => ` <tr><td>${customer.name}</td><td>${customer.invoices_count || 0}</td><td>${formatCurrency(customer.total_invoices_amount || 0)}</td><td>${formatCurrency(customer.total_payments || 0)}</td><td><span class="${(customer.balance || 0) >= 0 ? 'balance-positive' : 'balance-negative'}"> ${formatCurrency(customer.balance || 0)} </span></td><td>${customer.last_invoice_date ? formatDate(customer.last_invoice_date) : '-'}</td><td><span class="status-badge ${getCustomerStatus(customer.balance)}"> ${getCustomerStatusText(customer.balance)} </span></td></tr> `).join(''); } // Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª function displayDebtsReport(data) { // Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù„Ø®Øµ const totalDebt = data.reduce((sum, debt) => sum + debt.debt_amount, 0); const overdueDebts = data.filter(debt => debt.days_overdue > 0); const criticalDebts = data.filter(debt => debt.days_overdue > 30); const summaryCards = document.getElementById('summaryCards'); summaryCards.innerHTML = ` <div class="summary-card total"><div class="summary-number">${data.length}</div><div class="summary-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…Ø¯ÙŠÙ†ÙŠÙ†</div></div><div class="summary-card overdue"><div class="summary-number">${formatCurrency(totalDebt)}</div><div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</div></div><div class="summary-card pending"><div class="summary-number">${overdueDebts.length}</div><div class="summary-label">Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ù…ØªØ£Ø®Ø±Ø©</div></div><div class="summary-card paid"><div class="summary-number">${criticalDebts.length}</div><div class="summary-label">Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø­Ø±Ø¬Ø©</div></div> `; // Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ const tableHead = document.getElementById('detailsTableHead'); const tableBody = document.getElementById('detailsTableBody'); tableHead.innerHTML = ` <tr><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>ÙƒÙˆØ¯ Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</th><th>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</th><th>Ø£Ù‚Ø¯Ù… ÙØ§ØªÙˆØ±Ø©</th><th>Ø£ÙŠØ§Ù… Ø§Ù„ØªØ£Ø®ÙŠØ±</th><th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·Ø±</th></tr> `; if (data.length === 0) { tableBody.innerHTML = ` <tr><td colspan="7" class="empty-state"><div class="icon">ğŸ’°</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</h3><p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø³Ø¯Ø¯ÙŠÙ†</p></td></tr> `; return; } tableBody.innerHTML = data.map(debt => ` <tr><td>${debt.customer_name}</td><td>${debt.customer_code}</td><td>${formatCurrency(debt.debt_amount)}</td><td>${debt.invoices_count}</td><td>${debt.oldest_due_date ? formatDate(debt.oldest_due_date) : '-'}</td><td>${debt.days_overdue} ÙŠÙˆÙ…</td><td><div class="debt-indicator"><span class="debt-level ${getDebtLevel(debt.days_overdue)}"> ${getDebtLevelText(debt.days_overdue)} </span></div></td></tr> `).join(''); } // Ø¹Ø±Ø¶ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª function displayPaymentsReport(data) { // Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù„Ø®Øµ const totalAmount = data.reduce((sum, payment) => sum + payment.amount, 0); const cashPayments = data.filter(payment => payment.payment_method === 'cash'); const checkPayments = data.filter(payment => payment.payment_method === 'check'); const summaryCards = document.getElementById('summaryCards'); summaryCards.innerHTML = ` <div class="summary-card total"><div class="summary-number">${data.length}</div><div class="summary-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø§Øª</div></div><div class="summary-card paid"><div class="summary-number">${formatCurrency(totalAmount)}</div><div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº</div></div><div class="summary-card pending"><div class="summary-number">${cashPayments.length}</div><div class="summary-label">Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù†Ù‚Ø¯ÙŠØ©</div></div><div class="summary-card overdue"><div class="summary-number">${checkPayments.length}</div><div class="summary-label">Ù…Ø¯ÙÙˆØ¹Ø§Øª Ø´ÙŠÙƒØ§Øª</div></div> `; // Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ const tableHead = document.getElementById('detailsTableHead'); const tableBody = document.getElementById('detailsTableBody'); tableHead.innerHTML = ` <tr><th>Ø±Ù‚Ù… Ø§Ù„Ø¯ÙØ¹Ø©</th><th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr> `; if (data.length === 0) { tableBody.innerHTML = ` <tr><td colspan="7" class="empty-state"><div class="icon">ğŸ’³</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª</h3><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙÙˆØ¹Ø§Øª Ù„Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</p></td></tr> `; return; } tableBody.innerHTML = data.map(payment => ` <tr><td>${payment.payment_number}</td><td>${payment.customer_name || '-'}</td><td>${formatCurrency(payment.amount)}</td><td>${getPaymentMethodText(payment.payment_method)}</td><td>${formatDate(payment.payment_date)}</td><td>${payment.reference_number || '-'}</td><td>${payment.notes || '-'}</td></tr> `).join(''); } // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª function switchReportTab(tabName) { // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª document.querySelectorAll('.tab-content').forEach(tab => { tab.classList.remove('active'); }); document.querySelectorAll('.tab').forEach(tab => { tab.classList.remove('active'); }); // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø¯ document.getElementById(tabName).classList.add('active'); event.target.classList.add('active'); } // Ø¹Ø±Ø¶ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± function showReportsContent() { document.getElementById('reportsContent').style.display = 'block'; document.getElementById('reportsContent').scrollIntoView({ behavior: 'smooth' }); } // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ function showLoading() { const reportsContent = document.getElementById('reportsContent'); reportsContent.style.display = 'block'; reportsContent.innerHTML = ` <div class="loading"><div class="spinner"></div><p>Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...</p></div> `; } // ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± function exportReport() { if (!currentReportData) { showError('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„ØªØµØ¯ÙŠØ±Ù‡'); return; } // Ø³ÙŠØªÙ… ØªØ·ÙˆÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ø§Ø­Ù‚Ø§Ù‹ alert('Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Excel'); } // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± function printReport() { if (!currentReportData) { showError('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©'); return; } window.print(); } // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© function formatCurrency(amount) { return new Intl.NumberFormat('ar-SA', { style: 'currency', currency: 'SAR' }).format(amount || 0); } function formatDate(dateString) { return new Date(dateString).toLocaleDateString('ar-SA'); } function getCustomerStatus(balance) { if (balance > 0) return 'status-paid'; if (balance < 0) return 'status-overdue'; return 'status-pending'; } function getCustomerStatusText(balance) { if (balance > 0) return 'Ø¯Ø§Ø¦Ù†'; if (balance < 0) return 'Ù…Ø¯ÙŠÙ†'; return 'Ù…ØªÙˆØ§Ø²Ù†'; } function getDebtLevel(daysOverdue) { if (daysOverdue <= 0) return 'debt-low'; if (daysOverdue <= 30) return 'debt-medium'; return 'debt-high'; } function getDebtLevelText(daysOverdue) { if (daysOverdue <= 0) return 'Ø¬Ø§Ø±ÙŠ'; if (daysOverdue <= 30) return 'Ù…ØªØ£Ø®Ø±'; return 'Ø­Ø±Ø¬'; } function getPaymentMethodText(method) { const methodMap = { 'cash': 'Ù†Ù‚Ø¯ÙŠ', 'check': 'Ø´ÙŠÙƒ', 'transfer': 'ØªØ­ÙˆÙŠÙ„', 'card': 'Ø¨Ø·Ø§Ù‚Ø©' }; return methodMap[method] || method; } function showSuccess(message) { alert('âœ… ' + message); } function showError(message) { alert('âŒ ' + message); } </script></body></html> 