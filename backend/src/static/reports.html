<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>التقارير - نظام إدارة المخزون</title><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"><style> * { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; direction: rtl; } .container { max-width: 1200px; margin: 0 auto; padding: 20px; } .header { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); text-align: center; } .header h1 { color: #2c3e50; font-size: 2.5rem; margin-bottom: 10px; font-weight: 700; } .reports-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; margin-bottom: 30px; } .report-card { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; } .report-card:hover { transform: translateY(-5px); box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15); } .report-card h3 { color: #2c3e50; font-size: 1.4rem; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; } .report-card h3 i { color: #3498db; font-size: 1.6rem; } .form-group { margin-bottom: 15px; } .form-group label { display: block; margin-bottom: 5px; color: #2c3e50; font-weight: 600; } .form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease; } .form-group input:focus, .form-group select:focus { outline: none; border-color: #3498db; } .btn-group { display: flex; gap: 10px; margin-top: 20px; } .btn { flex: 1; padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: all 0.3s ease; text-decoration: none; display: inline-block; text-align: center; } .btn-primary { background: linear-gradient(135deg, #3498db, #2980b9); color: white; } .btn-success { background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; } .btn-warning { background: linear-gradient(135deg, #f39c12, #e67e22); color: white; } .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); } .results-section { background: rgba(255, 255, 255, 0.95); -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px); border-radius: 15px; padding: 25px; margin-top: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); display: none; } .results-section.show { display: block; } .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #e9ecef; } .results-header h3 { color: #2c3e50; font-size: 1.5rem; } .summary-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; } .summary-card { background: linear-gradient(135deg, #f8f9fa, #e9ecef); padding: 20px; border-radius: 10px; text-align: center; border: 1px solid #dee2e6; } .summary-card h4 { color: #3498db; font-size: 1.8rem; margin-bottom: 5px; } .summary-card p { color: #6c757d; font-size: 0.9rem; } .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); } .data-table th, .data-table td { padding: 12px; text-align: center; border-bottom: 1px solid #e9ecef; } .data-table th { background: #3498db; color: white; font-weight: 600; } .data-table tr:nth-child(even) { background: #f8f9fa; } .data-table tr:hover { background: #e3f2fd; } .loading { text-align: center; padding: 40px; color: #6c757d; } .loading i { font-size: 2rem; animation: spin 1s linear infinite; } @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } .back-btn { background: linear-gradient(135deg, #6c757d, #495057); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; text-decoration: none; display: inline-block; margin-bottom: 20px; transition: all 0.3s ease; } .back-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); } @media (max-width: 768px) { .reports-grid { grid-template-columns: 1fr; } .btn-group { flex-direction: column; } .summary-cards { grid-template-columns: repeat(2, 1fr); } } </style></head><body><div class="container"><!-- الرأس --><div class="header"><h1><i class="fas fa-chart-bar"></i> التقارير</h1><p>تقارير شاملة لإدارة المخزون والمبيعات والمشتريات</p><a href="/" class="back-btn"><i class="fas fa-arrow-right"></i> العودة للرئيسية </a></div><!-- شبكة التقارير --><div class="reports-grid"><!-- تقرير المخزون --><div class="report-card"><h3><i class="fas fa-boxes"></i> تقرير المخزون الحالي</h3><div class="form-group"><label for="inventory-warehouse">المخزن</label><select id="inventory-warehouse"><option value="">جميع المخازن</option></select></div><div class="form-group"><label for="inventory-category">الفئة</label><select id="inventory-category"><option value="">جميع الفئات</option></select></div><div class="form-group"><label><input type="checkbox" id="low-stock-only"> المخزون المنخفض فقط </label></div><div class="btn-group"><button type="button" class="btn btn-primary" onclick="generateInventoryReport()"><i class="fas fa-search"></i> عرض التقرير </button><button type="button" class="btn btn-success" onclick="printInventoryReport()"><i class="fas fa-print"></i> طباعة </button></div></div><!-- تقرير حركات المخزون --><div class="report-card"><h3><i class="fas fa-exchange-alt"></i> تقرير حركات المخزون</h3><div class="form-group"><label for="movements-start-date">من تاريخ</label><input type="date" id="movements-start-date"></div><div class="form-group"><label for="movements-end-date">إلى تاريخ</label><input type="date" id="movements-end-date"></div><div class="form-group"><label for="movements-type">نوع الحركة</label><select id="movements-type"><option value="">جميع الحركات</option><option value="purchase">مشتريات</option><option value="sale">مبيعات</option><option value="adjustment">تسوية</option><option value="transfer">نقل</option></select></div><div class="btn-group"><button type="button" class="btn btn-primary" onclick="generateMovementsReport()"><i class="fas fa-search"></i> عرض التقرير </button><button type="button" class="btn btn-success" onclick="printMovementsReport()"><i class="fas fa-print"></i> طباعة </button></div></div><!-- تقرير المبيعات --><div class="report-card"><h3><i class="fas fa-shopping-cart"></i> تقرير المبيعات</h3><div class="form-group"><label for="sales-start-date">من تاريخ</label><input type="date" id="sales-start-date"></div><div class="form-group"><label for="sales-end-date">إلى تاريخ</label><input type="date" id="sales-end-date"></div><div class="form-group"><label for="sales-customer">العميل</label><select id="sales-customer"><option value="">جميع العملاء</option></select></div><div class="btn-group"><button type="button" class="btn btn-primary" onclick="generateSalesReport()"><i class="fas fa-search"></i> عرض التقرير </button><button type="button" class="btn btn-success" onclick="printSalesReport()"><i class="fas fa-print"></i> طباعة </button></div></div><!-- تقرير المشتريات --><div class="report-card"><h3><i class="fas fa-truck"></i> تقرير المشتريات</h3><div class="form-group"><label for="purchases-start-date">من تاريخ</label><input type="date" id="purchases-start-date"></div><div class="form-group"><label for="purchases-end-date">إلى تاريخ</label><input type="date" id="purchases-end-date"></div><div class="form-group"><label for="purchases-supplier">المورد</label><select id="purchases-supplier"><option value="">جميع الموردين</option></select></div><div class="btn-group"><button type="button" class="btn btn-primary" onclick="generatePurchasesReport()"><i class="fas fa-search"></i> عرض التقرير </button><button type="button" class="btn btn-success" onclick="printPurchasesReport()"><i class="fas fa-print"></i> طباعة </button></div></div></div><!-- قسم النتائج --><div id="results-section" class="results-section"><div class="results-header"><h3 id="results-title">نتائج التقرير</h3><button type="button" class="btn btn-warning" onclick="exportToExcel()"><i class="fas fa-file-excel"></i> تصدير Excel </button></div><div id="summary-section" class="summary-cards"><!-- سيتم ملؤها ديناميكياً --></div><div id="data-section"><!-- سيتم ملؤها ديناميكياً --></div></div></div><script> // متغيرات عامة let currentReportData = null; let currentReportType = null; // تحميل البيانات الأولية document.addEventListener('DOMContentLoaded', function() { loadWarehouses(); loadCategories(); loadCustomers(); loadSuppliers(); setDefaultDates(); }); // تحميل المخازن async function loadWarehouses() { try { const response = await fetch('/api/warehouses'); const data = await response.json(); if (data.success) { const select = document.getElementById('inventory-warehouse'); data.data.forEach(warehouse => { const option = document.createElement('option'); option.value = warehouse.id; option.textContent = warehouse.name; select.appendChild(option); }); } } catch (error) { console.error('خطأ في تحميل المخازن:', error); } } // تحميل الفئات async function loadCategories() { try { const response = await fetch('/api/categories'); const data = await response.json(); if (data.success) { const select = document.getElementById('inventory-category'); data.data.forEach(category => { const option = document.createElement('option'); option.value = category.id; option.textContent = category.name; select.appendChild(option); }); } } catch (error) { console.error('خطأ في تحميل الفئات:', error); } } // تحميل العملاء async function loadCustomers() { try { const response = await fetch('/api/customers'); const data = await response.json(); if (data.success) { const select = document.getElementById('sales-customer'); data.data.forEach(customer => { const option = document.createElement('option'); option.value = customer.id; option.textContent = customer.name; select.appendChild(option); }); } } catch (error) { console.error('خطأ في تحميل العملاء:', error); } } // تحميل الموردين async function loadSuppliers() { try { const response = await fetch('/api/suppliers'); const data = await response.json(); if (data.success) { const select = document.getElementById('purchases-supplier'); data.data.forEach(supplier => { const option = document.createElement('option'); option.value = supplier.id; option.textContent = supplier.name; select.appendChild(option); }); } } catch (error) { console.error('خطأ في تحميل الموردين:', error); } } // تعيين التواريخ الافتراضية function setDefaultDates() { const today = new Date().toISOString().split('T')[0]; const lastMonth = new Date(); lastMonth.setMonth(lastMonth.getMonth() - 1); const lastMonthStr = lastMonth.toISOString().split('T')[0]; // تعيين التواريخ لجميع التقارير document.getElementById('movements-end-date').value = today; document.getElementById('movements-start-date').value = lastMonthStr; document.getElementById('sales-end-date').value = today; document.getElementById('sales-start-date').value = lastMonthStr; document.getElementById('purchases-end-date').value = today; document.getElementById('purchases-start-date').value = lastMonthStr; } // إنشاء تقرير المخزون async function generateInventoryReport() { showLoading(); try { const warehouseId = document.getElementById('inventory-warehouse').value; const categoryId = document.getElementById('inventory-category').value; const lowStockOnly = document.getElementById('low-stock-only').checked; const params = new URLSearchParams(); if (warehouseId) params.append('warehouse_id', warehouseId); if (categoryId) params.append('category_id', categoryId); if (lowStockOnly) params.append('low_stock_only', 'true'); const response = await fetch(`/api/inventory-report?${params}`); const data = await response.json(); if (data.success) { currentReportData = data.data; currentReportType = 'inventory'; displayInventoryReport(data.data); } else { alert('خطأ في إنشاء التقرير: ' + data.message); } } catch (error) { console.error('خطأ في إنشاء تقرير المخزون:', error); alert('حدث خطأ في إنشاء التقرير'); } } // عرض تقرير المخزون function displayInventoryReport(data) { document.getElementById('results-title').textContent = 'تقرير المخزون الحالي'; // عرض الملخص const summaryHtml = ` <div class="summary-card"><h4>${data.summary.total_products}</h4><p>إجمالي الأصناف</p></div><div class="summary-card"><h4>${data.summary.total_value.toLocaleString()}</h4><p>قيمة المخزون (جنيه)</p></div><div class="summary-card"><h4>${data.summary.low_stock_count}</h4><p>أصناف منخفضة</p></div><div class="summary-card"><h4>${data.summary.report_date.split('T')[0]}</h4><p>تاريخ التقرير</p></div> `; document.getElementById('summary-section').innerHTML = summaryHtml; // عرض الجدول let tableHtml = ` <table class="data-table"><thead><tr><th>اسم الصنف</th><th>الفئة</th><th>المجموعة</th><th>الكمية الحالية</th><th>الوحدة</th><th>سعر التكلفة</th><th>قيمة المخزون</th><th>الحالة</th></tr></thead><tbody> `; data.inventory.forEach(item => { const statusClass = item.status === 'منخفض' ? 'style="color: red; font-weight: bold;"' : ''; tableHtml += ` <tr><td>${item.product_name}</td><td>${item.category}</td><td>${item.group}</td><td>${item.current_stock}</td><td>${item.unit}</td><td>${item.cost_price.toFixed(2)}</td><td>${item.stock_value.toFixed(2)}</td><td ${statusClass}>${item.status}</td></tr> `; }); tableHtml += '</tbody></table>'; document.getElementById('data-section').innerHTML = tableHtml; showResults(); } // إنشاء تقرير حركات المخزون async function generateMovementsReport() { showLoading(); try { const startDate = document.getElementById('movements-start-date').value; const endDate = document.getElementById('movements-end-date').value; const movementType = document.getElementById('movements-type').value; const params = new URLSearchParams(); if (startDate) params.append('start_date', startDate); if (endDate) params.append('end_date', endDate); if (movementType) params.append('movement_type', movementType); const response = await fetch(`/api/stock-movements-report?${params}`); const data = await response.json(); if (data.success) { currentReportData = data.data; currentReportType = 'movements'; displayMovementsReport(data.data); } else { alert('خطأ في إنشاء التقرير: ' + data.message); } } catch (error) { console.error('خطأ في إنشاء تقرير الحركات:', error); alert('حدث خطأ في إنشاء التقرير'); } } // عرض تقرير حركات المخزون function displayMovementsReport(data) { document.getElementById('results-title').textContent = 'تقرير حركات المخزون'; // عرض الملخص const summaryHtml = ` <div class="summary-card"><h4>${data.summary.total_movements}</h4><p>إجمالي الحركات</p></div><div class="summary-card"><h4>${data.summary.total_quantity_in}</h4><p>إجمالي الوارد</p></div><div class="summary-card"><h4>${data.summary.total_quantity_out}</h4><p>إجمالي الصادر</p></div><div class="summary-card"><h4>${data.summary.total_value.toLocaleString()}</h4><p>القيمة الإجمالية</p></div> `; document.getElementById('summary-section').innerHTML = summaryHtml; // عرض الجدول let tableHtml = ` <table class="data-table"><thead><tr><th>التاريخ</th><th>نوع الحركة</th><th>الصنف</th><th>المخزن</th><th>الكمية الواردة</th><th>الكمية الصادرة</th><th>سعر الوحدة</th><th>المبلغ الإجمالي</th></tr></thead><tbody> `; data.movements.forEach(movement => { tableHtml += ` <tr><td>${movement.date.split('T')[0]}</td><td>${movement.type}</td><td>${movement.product_name}</td><td>${movement.warehouse_name}</td><td>${movement.quantity_in || '-'}</td><td>${movement.quantity_out || '-'}</td><td>${movement.unit_price.toFixed(2)}</td><td>${movement.total_amount.toFixed(2)}</td></tr> `; }); tableHtml += '</tbody></table>'; document.getElementById('data-section').innerHTML = tableHtml; showResults(); } // إنشاء تقرير المبيعات async function generateSalesReport() { showLoading(); try { const startDate = document.getElementById('sales-start-date').value; const endDate = document.getElementById('sales-end-date').value; const customerId = document.getElementById('sales-customer').value; const params = new URLSearchParams(); if (startDate) params.append('start_date', startDate); if (endDate) params.append('end_date', endDate); if (customerId) params.append('customer_id', customerId); const response = await fetch(`/api/sales-report?${params}`); const data = await response.json(); if (data.success) { currentReportData = data.data; currentReportType = 'sales'; displaySalesReport(data.data); } else { alert('خطأ في إنشاء التقرير: ' + data.message); } } catch (error) { console.error('خطأ في إنشاء تقرير المبيعات:', error); alert('حدث خطأ في إنشاء التقرير'); } } // عرض تقرير المبيعات function displaySalesReport(data) { document.getElementById('results-title').textContent = 'تقرير المبيعات'; // عرض الملخص const summaryHtml = ` <div class="summary-card"><h4>${data.summary.total_sales}</h4><p>عدد المبيعات</p></div><div class="summary-card"><h4>${data.summary.total_quantity}</h4><p>إجمالي الكمية</p></div><div class="summary-card"><h4>${data.summary.total_amount.toLocaleString()}</h4><p>إجمالي المبلغ</p></div><div class="summary-card"><h4>${data.summary.average_sale.toFixed(2)}</h4><p>متوسط البيعة</p></div> `; document.getElementById('summary-section').innerHTML = summaryHtml; // عرض الجدول let tableHtml = ` <table class="data-table"><thead><tr><th>التاريخ</th><th>الصنف</th><th>العميل</th><th>الكمية</th><th>سعر الوحدة</th><th>المبلغ الإجمالي</th></tr></thead><tbody> `; data.sales.forEach(sale => { tableHtml += ` <tr><td>${sale.date.split('T')[0]}</td><td>${sale.product_name}</td><td>${sale.customer_name}</td><td>${sale.quantity}</td><td>${sale.unit_price.toFixed(2)}</td><td>${sale.total_amount.toFixed(2)}</td></tr> `; }); tableHtml += '</tbody></table>'; document.getElementById('data-section').innerHTML = tableHtml; showResults(); } // إنشاء تقرير المشتريات async function generatePurchasesReport() { showLoading(); try { const startDate = document.getElementById('purchases-start-date').value; const endDate = document.getElementById('purchases-end-date').value; const supplierId = document.getElementById('purchases-supplier').value; const params = new URLSearchParams(); if (startDate) params.append('start_date', startDate); if (endDate) params.append('end_date', endDate); if (supplierId) params.append('supplier_id', supplierId); const response = await fetch(`/api/purchases-report?${params}`); const data = await response.json(); if (data.success) { currentReportData = data.data; currentReportType = 'purchases'; displayPurchasesReport(data.data); } else { alert('خطأ في إنشاء التقرير: ' + data.message); } } catch (error) { console.error('خطأ في إنشاء تقرير المشتريات:', error); alert('حدث خطأ في إنشاء التقرير'); } } // عرض تقرير المشتريات function displayPurchasesReport(data) { document.getElementById('results-title').textContent = 'تقرير المشتريات'; // عرض الملخص const summaryHtml = ` <div class="summary-card"><h4>${data.summary.total_purchases}</h4><p>عدد المشتريات</p></div><div class="summary-card"><h4>${data.summary.total_quantity}</h4><p>إجمالي الكمية</p></div><div class="summary-card"><h4>${data.summary.total_amount.toLocaleString()}</h4><p>إجمالي المبلغ</p></div><div class="summary-card"><h4>${data.summary.average_purchase.toFixed(2)}</h4><p>متوسط الشراء</p></div> `; document.getElementById('summary-section').innerHTML = summaryHtml; // عرض الجدول let tableHtml = ` <table class="data-table"><thead><tr><th>التاريخ</th><th>الصنف</th><th>المورد</th><th>الكمية</th><th>سعر الوحدة</th><th>المبلغ الإجمالي</th></tr></thead><tbody> `; data.purchases.forEach(purchase => { tableHtml += ` <tr><td>${purchase.date.split('T')[0]}</td><td>${purchase.product_name}</td><td>${purchase.supplier_name}</td><td>${purchase.quantity}</td><td>${purchase.unit_price.toFixed(2)}</td><td>${purchase.total_amount.toFixed(2)}</td></tr> `; }); tableHtml += '</tbody></table>'; document.getElementById('data-section').innerHTML = tableHtml; showResults(); } // طباعة تقرير المخزون async function printInventoryReport() { if (!currentReportData || currentReportType !== 'inventory') { alert('يرجى إنشاء التقرير أولاً'); return; } try { const response = await fetch('/api/print-inventory-report', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(currentReportData) }); if (response.ok) { const blob = await response.blob(); const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `inventory_report_${new Date().toISOString().split('T')[0]}.pdf`; document.body.appendChild(a); a.click(); window.URL.revokeObjectURL(url); document.body.removeChild(a); } else { alert('خطأ في طباعة التقرير'); } } catch (error) { console.error('خطأ في طباعة التقرير:', error); alert('حدث خطأ في طباعة التقرير'); } } // طباعة التقارير الأخرى (مؤقتاً) function printMovementsReport() { alert('سيتم تطوير طباعة تقرير الحركات قريباً'); } function printSalesReport() { alert('سيتم تطوير طباعة تقرير المبيعات قريباً'); } function printPurchasesReport() { alert('سيتم تطوير طباعة تقرير المشتريات قريباً'); } // تصدير إلى Excel (مؤقتاً) function exportToExcel() { alert('سيتم تطوير التصدير إلى Excel قريباً'); } // عرض شاشة التحميل function showLoading() { document.getElementById('data-section').innerHTML = ` <div class="loading"><i class="fas fa-spinner"></i><p>جاري إنشاء التقرير...</p></div> `; document.getElementById('summary-section').innerHTML = ''; document.getElementById('results-section').classList.add('show'); } // عرض النتائج function showResults() { document.getElementById('results-section').classList.add('show'); } </script></body></html> 